<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
Class User_management extends CI_Controller { 
	function __construct(){ 		parent::__construct(); 				$this->data_request = $_REQUEST;				$module = $this->router->module;		$directory = $this->router->directory;		$class = $this->router->class;		$method = $this->router->method;		$directory = trim(str_replace('../modules/'.$module ,'',str_replace('/controllers/','',$directory)),'/');				$this->module = $module;		if(trim($directory) != ''){			$this->directory = $directory;		} else {			$this->directory = '0';			$this->directory2 = '';		}		$this->class = $class;		$this->method = $method;	}		function user_management_table(){		$view = 'view_user';		$get_field = $this->ecc_library->get_field($view);				$get_field['r1']['hidden'] = true;		$get_field['r12']['hidden'] = true;		$get_field['r13']['hidden'] = true;		$get_field['r14']['hidden'] = true;		$get_field['r15']['hidden'] = true;		$get_field['r16']['hidden'] = true;		$get_field['r17']['hidden'] = true;		$get_field['r18']['hidden'] = true;		$get_field['r2']['width'] = 150;		$get_field['r3']['width'] = 150;		$get_field['r4']['width'] = 150;		$get_field['r5']['width'] = 150;		$get_field['r6']['width'] = 150;		$get_field['r9']['width'] = 170;		$get_field['r11']['width'] = 170;				return $get_field;	}		function index(){		$this->load->model('main');		$component['loadlayout'] = true;		$component['view_load'] = 'user_security/user_management/view';		$component['view_load_form'] = 'user_security/user_management/form';		$component['load_js'][] = 'user_security/user_management/view';		$component['load_js'][] = 'user_security/user_management/form';				$component['page_title'] = 'User Management';				$dashboard_table = array();				$nav_button = array();		$nav_button[] = array('method_id' => 553,'title' => 'Add', 'icon' => 'fa fa-plus', 'load' => 'user_security/user_management/function_add');		$nav_button[] = array('method_id' => 554,'title' => 'Edit', 'icon' => 'fa fa-pencil', 'load' => 'user_security/user_management/function_edit');		$nav_button[] = array('method_id' => 555,'title' => 'Delete', 'icon' => 'fa fa-trash-o', 'load' => 'user_security/user_management/function_delete');				$field = $this->user_management_table();				$dashboard_table['nav_button'] = $nav_button;		$dashboard_table['field'] = $field;				$component['dashboard_table'] = $dashboard_table;				$work_process_list = array();		$order = "work_process asc";		$data_table = $this->main->getData('dbo.view_work_process', null, null, null, $order);		if($data_table){			foreach($data_table as $dt_table){				$row = array();				foreach($dt_table as $key=>$value){					$row[$key] = $value;				}								$work_process_list[] = $row;			}		}				$newdata = array(			'work_process_list'  => $work_process_list		);		$this->session->set_userdata($newdata);							$this->authentication->ajaxlayout($component);	}		function loaddata(){		$this->authentication->plainlayout();				$view = 'view_user';		$field = $this->user_management_table();				$return = array();		$return['valid'] = false;		$return['message'] = "Internal Server Error"; 		$loaddata = $this->ecc_library->get_field_data($view,$field);					echo $loaddata;	}		function post_add_edit(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$user_id = isset($_POST['user_id']) ? $_POST['user_id'] : null;		$username = isset($_POST['username']) ? $_POST['username'] : '';		$password = isset($_POST['password']) ? $_POST['password'] : '';		$confirm_password = isset($_POST['confirm_password']) ? $_POST['confirm_password'] : '';		$name = isset($_POST['name']) ? $_POST['name'] : '';		$email = isset($_POST['email']) ? $_POST['email'] : '';		$phone = isset($_POST['phone']) ? $_POST['phone'] : '';		$role_id = isset($_POST['role_id']) ? $_POST['role_id'] : '';		$user_status_id = isset($_POST['user_status_id']) ? $_POST['user_status_id'] : '';		$work_process_id = isset($_POST['work_process_id']) ? $_POST['work_process_id'] : array();				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";		//var_dump($password);die();		if(count($_POST) > 0){						if($user_id){				$this->rpc_service->setSP("dbo.sp_user_edit");				$this->rpc_service->addField('user_id',$user_id);			} else {				$this->rpc_service->setSP("dbo.sp_user_add");			}						$this->rpc_service->addField('username',$username);			$this->rpc_service->addField('password',md5($password));			$this->rpc_service->addField('confirm_password',md5($confirm_password));			$this->rpc_service->addField('name',$name);			$this->rpc_service->addField('email',$email);			$this->rpc_service->addField('phone',$phone);			$this->rpc_service->addField('role_id',$role_id);			$this->rpc_service->addField('user_status_id',$user_status_id);						foreach($work_process_id as $key=>$value){				if($value > 0){					$data = array();					$data['work_process_id'] = $key;										$this->rpc_service->addAttributeChild('dt' ,$data);				}			}						//$result = $this->rpc_service->resultJSON();
			$result = $this->rpc_service->resultJSON_pop();		//	var_dump($password);			//var_dump($result);			// print_r($result);						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}		function delete(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$user_id = isset($_POST['user_id']) ? $_POST['user_id'] : false;				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){						if($user_id){				$this->rpc_service->setSP("dbo.sp_user_delete");				$this->rpc_service->addField('user_id',$user_id);			}								$result = $this->rpc_service->resultJSON();			// print_r($result);						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}
}?>