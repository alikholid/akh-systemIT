?><?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
Class Bill_of_material_process extends CI_Controller { 
	function __construct(){ 		parent::__construct(); 				$this->data_request = $_REQUEST;				$module = $this->router->module;		$directory = $this->router->directory;		$class = $this->router->class;		$method = $this->router->method;		$directory = trim(str_replace('../modules/'.$module ,'',str_replace('/controllers/','',$directory)),'/');				$this->module = $module;		if(trim($directory) != ''){			$this->directory = $directory;		} else {			$this->directory = '0';			$this->directory2 = '';		}		$this->class = $class;		$this->method = $method;	}		function bom_process_table(){		$view = 'view_bom_process';		$get_field = $this->ecc_library->get_field($view);				$get_field['r1']['hidden'] = true;		$get_field['r10']['hidden'] = true;		$get_field['r11']['hidden'] = true;		$get_field['r12']['hidden'] = true;		$get_field['r13']['hidden'] = true;		$get_field['r14']['hidden'] = true;		$get_field['r15']['hidden'] = true;				$get_field['r2']['width'] = 150;		$get_field['r3']['width'] = 200;		$get_field['r4']['width'] = 200;		$get_field['r7']['width'] = 170;		$get_field['r9']['width'] = 170;				return $get_field;	}		function bom_process_detail_table() {		$view = 'view_bom_process_detail';		$get_field = $this->ecc_library->get_field($view);				$get_field['r1']['hidden'] = true;		$get_field['r2']['hidden'] = true;		$get_field['r6']['hidden'] = true;		$get_field['r7']['hidden'] = true;		$get_field['r8']['hidden'] = true;				$get_field['act']['sc'] = 'act';		$get_field['act']['title'] = '#';		$get_field['act']['bypassvalue'] = '';		$get_field['act']['ctype'] = 'text';		$get_field['act']['align'] = 'center';		$get_field['act']['search'] = false;		$get_field['act']['sortable'] = false;		$get_field['act']['formatter'] = 'formatOperations';		$get_field['act']['width'] = 300;				return $get_field;	}		function index(){		$this->load->model('main');		$component['loadlayout'] = true;		$component['view_load'] = 'manufacture/bill_of_material_process/view';		$component['view_load_form'] = 'manufacture/bill_of_material_process/form';		$component['load_js'][] = 'manufacture/bill_of_material_process/view';		$component['load_js'][] = 'manufacture/bill_of_material_process/form';				$component['page_title'] = 'Bill Of Material Process';				$dashboard_table = array();				$nav_button = array();		$nav_button[] = array('method_id' => 428,'title' => 'Add', 'icon' => 'fa fa-plus', 'load' => 'manufacture/bill_of_material_process/function_add');		$nav_button[] = array('method_id' => 429,'title' => 'Edit', 'icon' => 'fa fa-pencil', 'load' => 'manufacture/bill_of_material_process/function_edit');		$nav_button[] = array('method_id' => 418,'title' => 'Approve', 'icon' => 'fa fa-pencil', 'load' => 'manufacture/bill_of_material_process/function_approve');		$nav_button[] = array('method_id' => 559,'title' => 'Set Default', 'icon' => 'fa fa-check', 'load' => 'manufacture/bill_of_material_process/function_set_default');		$nav_button[] = array('method_id' => 431,'title' => 'Delete', 'icon' => 'fa fa-trash-o', 'load' => 'manufacture/bill_of_material_process/function_delete');		$nav_button[] = array('method_id' => 797,'title' => 'Cancel Approve', 'icon' => 'fa fa-pencil', 'load' => 'manufacture/bill_of_material_process/function_cancel_approve');				$field = $this->bom_process_table();		$field_detail = $this->bom_process_detail_table();				$dashboard_table['nav_button'] = $nav_button;		$dashboard_table['field'] = $field;		$dashboard_table['field_detail'] = $field_detail;		$dashboard_table['field_detail_loaddata'] = 'loaddata_detail';		$component['dashboard_table'] = $dashboard_table;				$this->authentication->ajaxlayout($component);	}		function loaddata(){		$this->authentication->plainlayout();				$view = 'view_bom_process';		$field = $this->bom_process_table();				$return = array();		$return['valid'] = false;		$return['message'] = "Internal Server Error"; 		$loaddata = $this->ecc_library->get_field_data($view,$field);					echo $loaddata;	}		function post_add_edit(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$bom_process_id = isset($_POST['bom_process_id']) ? $_POST['bom_process_id'] : '';		$bom_process_code = isset($_POST['bom_process_code']) ? $_POST['bom_process_code'] : '';		$bom_process_name = isset($_POST['bom_process_name']) ? $_POST['bom_process_name'] : '';				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){			if($bom_process_id){				$this->rpc_service->setSP("dbo.sp_bom_process_edit");				$this->rpc_service->addField('bom_process_id',$bom_process_id);			} else {				$this->rpc_service->setSP("dbo.sp_bom_process_add");			}						$this->rpc_service->addField('bom_process_code',$bom_process_code);			$this->rpc_service->addField('bom_process_name',$bom_process_name);									$result = $this->rpc_service->resultJSON();									$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$data_result = json_decode($result['data'],true);														$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];														$return['bom_process_id'] = $data_result['bom_process_id'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}		function approve(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$bom_process_id = isset($_POST['bom_process_id']) ? $_POST['bom_process_id'] : false;				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){						if($bom_process_id){				$this->rpc_service->setSP("dbo.sp_bom_process_approve");				$this->rpc_service->addField('bom_process_id',$bom_process_id);			}								$result = $this->rpc_service->resultJSON();						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}		function cancel_approve(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$bom_process_id = isset($_POST['bom_process_id']) ? $_POST['bom_process_id'] : false;				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){						if($bom_process_id){				$this->rpc_service->setSP("dbo.sp_bom_process_cancel_approve");				$this->rpc_service->addField('bom_process_id',$bom_process_id);			}								$result = $this->rpc_service->resultJSON();						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}		function delete(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$bom_process_id = isset($_POST['bom_process_id']) ? $_POST['bom_process_id'] : false;				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){						if($bom_process_id){				$this->rpc_service->setSP("dbo.sp_bom_process_delete");				$this->rpc_service->addField('bom_process_id',$bom_process_id);			}								$result = $this->rpc_service->resultJSON();			// print_r($result);						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}		function loaddata_detail(){		$this->authentication->plainlayout();				$bom_process_id = isset($_REQUEST['bom_process_id']) ? is_numeric($_REQUEST['bom_process_id']) ? $_REQUEST['bom_process_id']  : -1 : -1;		$methodid = isset($_REQUEST['methodid']) ? is_numeric($_REQUEST['methodid']) ? $_REQUEST['methodid']  : -1 : -1;				$view = 'view_bom_process_detail';		$field = $this->bom_process_detail_table();				$return = array();		$return['valid'] = false;		$return['message'] = "Internal Server Error";				$extra_param = array();		$extra_param['where']['0']['field'] = 'r2';		$extra_param['where']['0']['data'] = $bom_process_id;		$extra_param['methodid'] = $methodid;				$loaddata = $this->ecc_library->get_field_data($view,$field,$extra_param);					echo $loaddata;	}		function post_add_edit_detail(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();				$bom_process_id = isset($_POST['bom_process_id']) ? $_POST['bom_process_id'] : 0;		$bom_process_detail_id = isset($_POST['bom_process_detail_id']) ? $_POST['bom_process_detail_id'] : '';		$work_process_id = isset($_POST['work_process_id']) ? $_POST['work_process_id'] : '';		$bom_id = isset($_POST['bom_id']) ? $_POST['bom_id'] : '';				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){			if($bom_process_detail_id){				$this->rpc_service->setSP("dbo.sp_bom_process_detail_edit");				$this->rpc_service->addField('bom_process_detail_id',$bom_process_detail_id);			} else {				$this->rpc_service->setSP("dbo.sp_bom_process_detail_add");			}						$this->rpc_service->addField('bom_process_id',$bom_process_id);			$this->rpc_service->addField('work_process_id',$work_process_id);			$this->rpc_service->addField('bom_id',$bom_id);						$result = $this->rpc_service->resultJSON();						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$data = json_decode($result['data'],TRUE);							$bom_process_id = $data['bom_process_id'];							$bom_process_detail_id = $data['bom_process_detail_id'];							$bom_process_text = $data['bom_process'];							$bom = $data['bom'];							$item = $data['item'];							$work_process_id = $data['work_process_id'];							$bom_id = $data['bom_id'];														$bom_process = $this->session->userdata('bom_process');														$row = array();							//$row['bom_process_index'] = $seq;							$row['bom_process'] = $bom_process_text;							$row['item'] = $item;							$row['bom'] = $bom;							$row['work_process_id'] = $work_process_id;							$row['bom_id'] = $bom_id;							$row['bom_process_detail_id'] = $bom_process_detail_id;							$row['bom_process_id'] = $bom_process_id;														//$bom_process[$seq] = $row;							$newdata = array(								'bom_process'  => $bom_process				///							);							$this->session->set_userdata($newdata);															$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];												}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}		function delete_detail(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";						$bom_process_detail_id = isset($_POST['bom_process_detail_id']) ? $_POST['bom_process_detail_id'] : '';		$user_id = $this->session->userdata('user_id');				if(count($_POST) > 0){						if($bom_process_detail_id){				$this->rpc_service_portal->setSP("dbo.sp_bom_process_detail_delete");				$this->rpc_service_portal->addField('bom_process_detail_id',$bom_process_detail_id);			}								$result = $this->rpc_service_portal->resultJSON();						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}		echo json_encode($return);	}		function set_default(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$bom_process_id = isset($_POST['bom_process_id']) ? $_POST['bom_process_id'] : false;				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){						if($bom_process_id){				$this->rpc_service->setSP("dbo.sp_bom_process_set_default");				$this->rpc_service->addField('bom_process_id',$bom_process_id);			}								$result = $this->rpc_service->resultJSON();			// print_r($result);						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}	
}?>