<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');Class Custom_import extends CI_Controller { 	function __construct(){ 		parent::__construct(); 				$this->data_request = $_REQUEST;				$module = $this->router->module;		$directory = $this->router->directory;		$class = $this->router->class;		$method = $this->router->method;		$directory = trim(str_replace('../modules/'.$module ,'',str_replace('/controllers/','',$directory)),'/');				$this->module = $module;		if(trim($directory) != ''){			$this->directory = $directory;		} else {			$this->directory = '0';			$this->directory2 = '';		}		$this->class = $class;		$this->method = $method;	}		function custom_import_table() {		$view = 'view_custom_import';		$get_field = $this->ecc_library->get_field($view);				$get_field['r1']['hidden'] = true;		$get_field['r2']['hidden'] = true;		$get_field['r3']['hidden'] = true;				$get_field['r16']['hidden'] = true;		$get_field['r17']['hidden'] = true;		$get_field['r18']['hidden'] = true;		$get_field['r19']['hidden'] = true;		$get_field['r20']['hidden'] = true;		$get_field['r21']['hidden'] = true;		$get_field['r22']['hidden'] = true;		$get_field['r23']['hidden'] = true;		$get_field['r24']['hidden'] = true;		$get_field['r25']['hidden'] = true;		$get_field['r26']['hidden'] = true;		$get_field['r27']['hidden'] = true;		$get_field['r28']['hidden'] = true;		$get_field['r29']['hidden'] = true;		$get_field['r30']['hidden'] = true;		$get_field['r31']['hidden'] = true;		$get_field['r32']['hidden'] = true;		$get_field['r33']['hidden'] = true;		$get_field['r34']['hidden'] = true;		$get_field['r35']['hidden'] = true;		$get_field['r36']['hidden'] = true;		$get_field['r37']['hidden'] = true;		$get_field['r38']['hidden'] = true;		$get_field['r39']['hidden'] = true;		$get_field['r40']['hidden'] = true;		$get_field['r41']['hidden'] = true;		$get_field['r42']['hidden'] = true;		$get_field['r43']['hidden'] = true;		$get_field['r44']['hidden'] = true;		$get_field['r45']['hidden'] = true;		$get_field['r46']['hidden'] = true;		$get_field['r47']['hidden'] = true;		$get_field['r48']['hidden'] = true;		$get_field['r49']['hidden'] = true;		$get_field['r50']['hidden'] = true;		$get_field['r51']['hidden'] = true;		$get_field['r52']['hidden'] = true;		$get_field['r53']['hidden'] = true;		$get_field['r54']['hidden'] = true;				return $get_field;	}		function custom_import_detail_table() {		$view = 'view_custom_import_detail';		$get_field = $this->ecc_library->get_field($view);				$get_field['r1']['hidden'] = true;		$get_field['r2']['hidden'] = true;		$get_field['r16']['hidden'] = true;		$get_field['r17']['hidden'] = true;		$get_field['r18']['hidden'] = true;		$get_field['r19']['hidden'] = true;		$get_field['r20']['hidden'] = true;		$get_field['r21']['hidden'] = true;		$get_field['r22']['hidden'] = true;		$get_field['r23']['hidden'] = true;		$get_field['r24']['hidden'] = true;		$get_field['r25']['hidden'] = true;		$get_field['r26']['hidden'] = true;		$get_field['r27']['hidden'] = true;				// $get_field['r14']['hidden'] = true;		// $get_field['r15']['hidden'] = true;		// $get_field['r16']['hidden'] = true;		// $get_field['r17']['hidden'] = true;		// $get_field['r18']['hidden'] = true;		// $get_field['r19']['hidden'] = true;				$get_field['act']['sc'] = 'act';		$get_field['act']['title'] = '#';		$get_field['act']['bypassvalue'] = '';		$get_field['act']['ctype'] = 'text';		$get_field['act']['align'] = 'center';		$get_field['act']['search'] = false;		$get_field['act']['sortable'] = false;		$get_field['act']['formatter'] = 'formatOperations';		$get_field['act']['width'] = 300;				return $get_field;	}		function index(){		$this->load->model('main');		$component['loadlayout'] = true;		$component['view_load'] = 'custom_import/view';		$component['view_load_form'] = 'custom_import/form';		$component['load_js'][] = 'custom_import/view';		$component['load_js'][] = 'custom_import/form';						$dashboard_table = array();				$nav_button = array();		$nav_button[] = array('method_id' => 141,'title' => 'Add', 'icon' => 'fa fa-plus', 'load' => 'custom_import/function_add');		$nav_button[] = array('method_id' => 149,'title' => 'Add From Request', 'icon' => 'fa fa-plus', 'load' => 'custom_import/function_add_from_request');		$nav_button[] = array('method_id' => 142,'title' => 'Edit', 'icon' => 'fa fa-pencil', 'load' => 'custom_import/function_edit');		$nav_button[] = array('method_id' => 144,'title' => 'Approve', 'icon' => 'fa fa-check', 'load' => 'custom_import/function_approve');		$nav_button[] = array('method_id' => 143,'title' => 'Delete', 'icon' => 'fa fa-trash-o', 'load' => 'custom_import/function_delete');				$field = $this->custom_import_table();				$dashboard_table['nav_button'] = $nav_button;		$dashboard_table['field'] = $field;				$component['dashboard_table'] = $dashboard_table;				$this->authentication->ajaxlayout($component);	}		function bc20(){		$this->load->model('main');		$custom_type_id = 1;				$component['loadlayout'] = true;				$component['view_load'] = 'custom_import/view';		$component['view_load_form'] = 'custom_import/form';		$component['load_js'][] = 'custom_import/view';		$component['load_js'][] = 'custom_import/form';						$component['custom_type_id'] = $custom_type_id;		$component['search_param'] = 'custom_type_id';		$component['search_param_value'] = $custom_type_id;		$component['page_title'] = 'BC 2.0';				$dashboard_table = array();				$nav_button = array();		$nav_button[] = array('method_id' => 172,'title' => 'New', 'icon' => 'fa fa-plus', 'load' => 'custom_import/function_add');		$nav_button[] = array('method_id' => 179,'title' => 'New From Proforma', 'icon' => 'fa fa-plus', 'load' => 'custom_import/function_add_from_performa');		// $nav_button[] = array('method_id' => 180,'title' => 'New From Purchase', 'icon' => 'fa fa-plus', 'load' => 'custom_import/function_add_from_purchase');		$nav_button[] = array('method_id' => 173,'title' => 'Edit', 'icon' => 'fa fa-pencil', 'load' => 'custom_import/function_edit');		$nav_button[] = array('method_id' => 174,'title' => 'Delete', 'icon' => 'fa fa-trash-o', 'load' => 'custom_import/function_delete');		$nav_button[] = array('method_id' => 175,'title' => 'Approve', 'icon' => 'fa fa-pencil', 'load' => 'custom_import/function_approve');		$nav_button[] = array('method_id' => 746,'title' => 'Cancel Approve', 'icon' => 'fa fa-cross', 'load' => 'custom_import/function_cancel_approve');				$field = $this->custom_import_table();		$field_detail = $this->custom_import_detail_table();				$dashboard_table['nav_button'] = $nav_button;		$dashboard_table['field'] = $field;		$dashboard_table['field_detail'] = $field_detail;		$dashboard_table['field_detail_loaddata'] = 'loaddata_detail';				$extra_data = array();		$extra_data['custom_type_id'] = $custom_type_id;		$dashboard_table['extra_data'] = $extra_data;				$component['dashboard_table'] = $dashboard_table;				$this->authentication->ajaxlayout($component);	}		function bc23(){		$this->load->model('main');		$custom_type_id = 2;				$component['loadlayout'] = true;				$component['view_load'] = 'custom_import/view';		$component['view_load_form'] = 'custom_import/form';		$component['load_js'][] = 'custom_import/view';		$component['load_js'][] = 'custom_import/form';						$component['custom_type_id'] = $custom_type_id;		$component['search_param'] = 'custom_type_id';		$component['search_param_value'] = $custom_type_id;		$component['page_title'] = 'BC 2.3';				$dashboard_table = array();				$nav_button = array();		$nav_button[] = array('method_id' => 185,'title' => 'New', 'icon' => 'fa fa-plus', 'load' => 'custom_import/function_add');		$nav_button[] = array('method_id' => 189,'title' => 'From Proforma', 'icon' => 'fa fa-plus', 'load' => 'custom_import/function_add_from_performa');		// $nav_button[] = array('method_id' => 196,'title' => 'New From Purchase', 'icon' => 'fa fa-plus', 'load' => 'custom_import/function_add_from_purchase');		$nav_button[] = array('method_id' => 593,'title' => 'From Contract Subcon', 'icon' => 'fa fa-plus', 'load' => 'custom_import/function_add_from_contract_subcon');		$nav_button[] = array('method_id' => 186,'title' => 'Edit', 'icon' => 'fa fa-pencil', 'load' => 'custom_import/function_edit');		$nav_button[] = array('method_id' => 187,'title' => 'Delete', 'icon' => 'fa fa-trash-o', 'load' => 'custom_import/function_delete');		$nav_button[] = array('method_id' => 188,'title' => 'Approve', 'icon' => 'fa fa-pencil', 'load' => 'custom_import/function_approve');		$nav_button[] = array('method_id' => 747,'title' => 'Cancel Approve', 'icon' => 'fa fa-cross', 'load' => 'custom_import/function_cancel_approve');		$nav_button[] = array('method_id' => 671,'title' => 'Send To TPB Ceisa', 'icon' => 'fa fa-upload', 'load' => 'custom_import/function_ceisa_send');		$nav_button[] = array('method_id' => 672,'title' => 'Get Register No', 'icon' => 'fa fa-download', 'load' => 'custom_import/function_ceisa_get_respon');		$nav_button[] = array('method_id' => 673,'title' => 'Cancel Send', 'icon' => 'fa fa-cross', 'load' => 'custom_import/function_ceisa_cancel_send');				$field = $this->custom_import_table();		$field_detail = $this->custom_import_detail_table();				$dashboard_table['nav_button'] = $nav_button;		$dashboard_table['field'] = $field;		$dashboard_table['field_detail'] = $field_detail;		$dashboard_table['field_detail_loaddata'] = 'loaddata_detail';				$extra_data = array();		$extra_data['custom_type_id'] = $custom_type_id;		$dashboard_table['extra_data'] = $extra_data;				$component['dashboard_table'] = $dashboard_table;				$this->authentication->ajaxlayout($component);	}		function bc262(){		$this->load->model('main');		$custom_type_id = 3;				$component['loadlayout'] = true;				$component['view_load'] = 'custom_import/view';		$component['view_load_form'] = 'custom_import/form';		$component['load_js'][] = 'custom_import/view';		$component['load_js'][] = 'custom_import/form';						$component['custom_type_id'] = $custom_type_id;		$component['search_param'] = 'custom_type_id';		$component['search_param_value'] = $custom_type_id;		$component['page_title'] = 'BC 2.6.2';				$dashboard_table = array();				$nav_button = array();		$nav_button[] = array('method_id' => 191,'title' => 'New', 'icon' => 'fa fa-plus', 'load' => 'custom_import/function_add');		$nav_button[] = array('method_id' => 195,'title' => 'From Proforma', 'icon' => 'fa fa-plus', 'load' => 'custom_import/function_add_from_performa');		// $nav_button[] = array('method_id' => 196,'title' => 'New From Purchase', 'icon' => 'fa fa-plus', 'load' => 'custom_import/function_add_from_purchase');		$nav_button[] = array('method_id' => 593,'title' => 'From Contract Subcon', 'icon' => 'fa fa-plus', 'load' => 'custom_import/function_add_from_contract_subcon');		$nav_button[] = array('method_id' => 192,'title' => 'Edit', 'icon' => 'fa fa-pencil', 'load' => 'custom_import/function_edit');		$nav_button[] = array('method_id' => 193,'title' => 'Delete', 'icon' => 'fa fa-trash-o', 'load' => 'custom_import/function_delete');		$nav_button[] = array('method_id' => 194,'title' => 'Approve', 'icon' => 'fa fa-pencil', 'load' => 'custom_import/function_approve');		$nav_button[] = array('method_id' => 748,'title' => 'Cancel Approve', 'icon' => 'fa fa-cross', 'load' => 'custom_import/function_cancel_approve');		$nav_button[] = array('method_id' => 671,'title' => 'Send To TPB Ceisa', 'icon' => 'fa fa-upload', 'load' => 'custom_import/function_ceisa_send');		$nav_button[] = array('method_id' => 672,'title' => 'Get Register No', 'icon' => 'fa fa-download', 'load' => 'custom_import/function_ceisa_get_respon');		$nav_button[] = array('method_id' => 673,'title' => 'Cancel Send', 'icon' => 'fa fa-cross', 'load' => 'custom_import/function_ceisa_cancel_send');				$field = $this->custom_import_table();		$field_detail = $this->custom_import_detail_table();				$dashboard_table['nav_button'] = $nav_button;		$dashboard_table['field'] = $field;		$dashboard_table['field_detail'] = $field_detail;		$dashboard_table['field_detail_loaddata'] = 'loaddata_detail';				$extra_data = array();		$extra_data['custom_type_id'] = $custom_type_id;		$dashboard_table['extra_data'] = $extra_data;				$component['dashboard_table'] = $dashboard_table;				$this->authentication->ajaxlayout($component);	}		function bc27(){		$this->load->model('main');		$custom_type_id = 4;				$component['loadlayout'] = true;				$component['view_load'] = 'custom_import/view';		$component['view_load_form'] = 'custom_import/form';		$component['load_js'][] = 'custom_import/view';		$component['load_js'][] = 'custom_import/form';						$component['custom_type_id'] = $custom_type_id;		$component['search_param'] = 'custom_type_id';		$component['search_param_value'] = $custom_type_id;		$component['page_title'] = 'BC 2.7';				$dashboard_table = array();				$nav_button = array();		$nav_button[] = array('method_id' => 197,'title' => 'New', 'icon' => 'fa fa-plus', 'load' => 'custom_import/function_add');		$nav_button[] = array('method_id' => 201,'title' => 'From Proforma', 'icon' => 'fa fa-plus', 'load' => 'custom_import/function_add_from_performa');		// $nav_button[] = array('method_id' => 202,'title' => 'New From Purchase', 'icon' => 'fa fa-plus', 'load' => 'custom_import/function_add_from_purchase');		$nav_button[] = array('method_id' => 670,'title' => 'From Contract Subcon', 'icon' => 'fa fa-plus', 'load' => 'custom_import/function_add_from_contract_subcon');		$nav_button[] = array('method_id' => 198,'title' => 'Edit', 'icon' => 'fa fa-pencil', 'load' => 'custom_import/function_edit');		$nav_button[] = array('method_id' => 199,'title' => 'Delete', 'icon' => 'fa fa-trash-o', 'load' => 'custom_import/function_delete');		$nav_button[] = array('method_id' => 200,'title' => 'Approve', 'icon' => 'fa fa-pencil', 'load' => 'custom_import/function_approve');		$nav_button[] = array('method_id' => 749,'title' => 'Cancel Approve', 'icon' => 'fa fa-cross', 'load' => 'custom_import/function_cancel_approve');				$field = $this->custom_import_table();		$field_detail = $this->custom_import_detail_table();				$dashboard_table['nav_button'] = $nav_button;		$dashboard_table['field'] = $field;		$dashboard_table['field_detail'] = $field_detail;		$dashboard_table['field_detail_loaddata'] = 'loaddata_detail';				$extra_data = array();		$extra_data['custom_type_id'] = $custom_type_id;		$dashboard_table['extra_data'] = $extra_data;				$component['dashboard_table'] = $dashboard_table;				$this->authentication->ajaxlayout($component);	}		function bc40(){		$this->load->model('main');		$custom_type_id = 5;				$component['loadlayout'] = true;				$component['view_load'] = 'custom_import/view';		$component['view_load_form'] = 'custom_import/form';		$component['load_js'][] = 'custom_import/view';		$component['load_js'][] = 'custom_import/form';						$component['custom_type_id'] = $custom_type_id;		$component['search_param'] = 'custom_type_id';		$component['search_param_value'] = $custom_type_id;		$component['page_title'] = 'BC 4.0';				$dashboard_table = array();				$nav_button = array();		$nav_button[] = array('method_id' => 203,'title' => 'New', 'icon' => 'fa fa-plus', 'load' => 'custom_import/function_add');		$nav_button[] = array('method_id' => 207,'title' => 'From Proforma', 'icon' => 'fa fa-plus', 'load' => 'custom_import/function_add_from_performa');		$nav_button[] = array('method_id' => 798,'title' => 'From Contract Subcon', 'icon' => 'fa fa-plus', 'load' => 'custom_import/function_add_from_contract_subcon');		$nav_button[] = array('method_id' => 204,'title' => 'Edit', 'icon' => 'fa fa-pencil', 'load' => 'custom_import/function_edit');		$nav_button[] = array('method_id' => 205,'title' => 'Delete', 'icon' => 'fa fa-trash-o', 'load' => 'custom_import/function_delete');		$nav_button[] = array('method_id' => 206,'title' => 'Approve', 'icon' => 'fa fa-pencil', 'load' => 'custom_import/function_approve');		$nav_button[] = array('method_id' => 750,'title' => 'Cancel Approve', 'icon' => 'fa fa-cross', 'load' => 'custom_import/function_cancel_approve');		$nav_button[] = array('method_id' => 671,'title' => 'Send To TPB Ceisa', 'icon' => 'fa fa-upload', 'load' => 'custom_import/function_ceisa_send');		$nav_button[] = array('method_id' => 672,'title' => 'Get Register No', 'icon' => 'fa fa-download', 'load' => 'custom_import/function_ceisa_get_respon');		$nav_button[] = array('method_id' => 673,'title' => 'Cancel Send', 'icon' => 'fa fa-cross', 'load' => 'custom_import/function_ceisa_cancel_send');				$field = $this->custom_import_table();		$field_detail = $this->custom_import_detail_table();				$dashboard_table['nav_button'] = $nav_button;		$dashboard_table['field'] = $field;		$dashboard_table['field_detail'] = $field_detail;		$dashboard_table['field_detail_loaddata'] = 'loaddata_detail';				$extra_data = array();		$extra_data['custom_type_id'] = $custom_type_id;		$dashboard_table['extra_data'] = $extra_data;				$component['dashboard_table'] = $dashboard_table;				$this->authentication->ajaxlayout($component);	}		function loaddata() {		$this->authentication->plainlayout();				$custom_type_id = isset($_REQUEST['custom_type_id']) ? is_numeric($_REQUEST['custom_type_id']) ? $_REQUEST['custom_type_id']  : -1 : -1;				$view = 'view_custom_import';		$field = $this->custom_import_table();				$return = array();		$return['valid'] = false;		$return['message'] = "Internal Server Error"; 		$extra_param = array();		$extra_param['where']['0']['field'] = 'r2';		$extra_param['where']['0']['data'] = $custom_type_id;				$loaddata = $this->ecc_library->get_field_data($view,$field,$extra_param);					echo $loaddata;	}			function approve(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$bc_in_header_id = isset($_POST['bc_in_header_id']) ? $_POST['bc_in_header_id'] : false;				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){						if($bc_in_header_id){				$this->rpc_service->setSP("dbo.sp_custom_import_approve");				$this->rpc_service->addField('bc_in_header_id',$bc_in_header_id);			}								$result = $this->rpc_service->resultJSON();			// print_r($result);						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}		function cancel_approve(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$bc_in_header_id = isset($_POST['bc_in_header_id']) ? $_POST['bc_in_header_id'] : false;				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){						if($bc_in_header_id){				$this->rpc_service->setSP("dbo.sp_custom_import_cancel_approve");				$this->rpc_service->addField('bc_in_header_id',$bc_in_header_id);			}								$result = $this->rpc_service->resultJSON();			// print_r($result);						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}		function delete(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$bc_in_header_id = isset($_POST['bc_in_header_id']) ? $_POST['bc_in_header_id'] : false;				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){						if($bc_in_header_id){				$this->rpc_service->setSP("dbo.sp_custom_import_delete");				$this->rpc_service->addField('bc_in_header_id',$bc_in_header_id);			}								$result = $this->rpc_service->resultJSON();			// print_r($result);						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}			function post_add_edit(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$bc_in_header_id = isset($_POST['bc_in_header_id']) ? $_POST['bc_in_header_id'] : '';		$custom_type_id = isset($_POST['custom_type_id']) ? $_POST['custom_type_id'] : '';		$bc_in_type_id = isset($_POST['bc_in_type_id']) ? $_POST['bc_in_type_id'] : '';		$car = isset($_POST['car']) ? $_POST['car'] : '';		$bc_no = isset($_POST['bc_no']) ? $_POST['bc_no'] : '';		$bc_date = isset($_POST['bc_date']) ? $_POST['bc_date'] : '';		$partner_id = isset($_POST['partner_id']) ? $_POST['partner_id'] : '';		$currencies_id = isset($_POST['currencies_id']) ? $_POST['currencies_id'] : '';		$purchase_performa_id = isset($_POST['purchase_performa_id']) ? $_POST['purchase_performa_id'] : '';		$purchase_order_id = isset($_POST['purchase_order_id']) ? $_POST['purchase_order_id'] : '';		$contract_subcon = isset($_POST['contract_subcon']) ? $_POST['contract_subcon'] : '';				$bongkar_port_id = isset($_POST['bongkar_port_id']) ? $_POST['bongkar_port_id'] : '';		$bongkar_kppbc_id = isset($_POST['bongkar_kppbc_id']) ? $_POST['bongkar_kppbc_id'] : '';		$tujuan_tpb_id = isset($_POST['tujuan_tpb_id']) ? $_POST['tujuan_tpb_id'] : '';		$jenis_tpb_id = isset($_POST['jenis_tpb_id']) ? $_POST['jenis_tpb_id'] : '';		$tujuan_pengiriman_id = isset($_POST['tujuan_pengiriman_id']) ? $_POST['tujuan_pengiriman_id'] : '';		$tujuan_pemasukan_id = isset($_POST['tujuan_pemasukan_id']) ? $_POST['tujuan_pemasukan_id'] : '';		$pjt_status_id = isset($_POST['pjt_status_id']) ? $_POST['pjt_status_id'] : '';		$cara_angkut_id = isset($_POST['cara_angkut_id']) ? $_POST['cara_angkut_id'] : '';		$nama_pengangkut = isset($_POST['nama_pengangkut']) ? $_POST['nama_pengangkut'] : false;		$nama_pengangkut2 = isset($_POST['nama_pengangkut2']) ? $_POST['nama_pengangkut2'] : '';				if(strlen(trim($nama_pengangkut)) == 0){			$nama_pengangkut = $nama_pengangkut2;		}				$nomor_voy_flight = isset($_POST['nomor_voy_flight']) ? $_POST['nomor_voy_flight'] : '';		$kode_bendera = isset($_POST['kode_bendera']) ? $_POST['kode_bendera'] : '';		$nomor_polisi = isset($_POST['nomor_polisi']) ? $_POST['nomor_polisi'] : '';		$ndpbm = isset($_POST['ndpbm']) ? $_POST['ndpbm'] : '';		$price_type_id = isset($_POST['price_type_id']) ? $_POST['price_type_id'] : '';		$amount_origin = isset($_POST['amount_origin']) ? $_POST['amount_origin'] : '';		$value_additional = isset($_POST['value_additional']) ? $_POST['value_additional'] : '';		$discount = isset($_POST['discount']) ? $_POST['discount'] : '';		$insurance_type_id = isset($_POST['insurance_type_id']) ? $_POST['insurance_type_id'] : '';		$amount_insurance = isset($_POST['amount_insurance']) ? $_POST['amount_insurance'] : '';		$amount_freight = isset($_POST['amount_freight']) ? $_POST['amount_freight'] : '';		$maklon = isset($_POST['maklon']) ? $_POST['maklon'] : '';		$tps_id = isset($_POST['tps_id']) ? $_POST['tps_id'] : '';		$muat_port_id = isset($_POST['muat_port_id']) ? $_POST['muat_port_id'] : '';		$transit_port_id = isset($_POST['transit_port_id']) ? $_POST['transit_port_id'] : '';		$vendor_partner_id = isset($_POST['vendor_partner_id']) ? $_POST['vendor_partner_id'] : '';				$purchase_performa = explode(',',$purchase_performa_id);		$purchase_order = explode(',',$purchase_order_id);		$contract_subcon = explode(',',$contract_subcon);				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){			if($bc_in_header_id){				$this->rpc_service->setSP("dbo.sp_custom_import_edit");				$this->rpc_service->addField('bc_in_header_id',$bc_in_header_id);			} else {				switch($bc_in_type_id){					case '1':						$this->rpc_service->setSP("dbo.sp_custom_import_add");					break;										case '2':						$this->rpc_service->setSP("dbo.sp_custom_import_add_from_performa");												foreach($purchase_performa as $dt_data){							$data = array('purchase_performa_id'=>$dt_data);							$this->rpc_service->addAttributeChild('dt' ,$data);						}					break;										case '3':						$this->rpc_service->setSP("dbo.sp_custom_import_add_from_purchase");												foreach($purchase_order as $dt_data){							$data = array('purchase_order_id'=>$dt_data);							$this->rpc_service->addAttributeChild('dt' ,$data);						}					break;										case '4':						$this->rpc_service->setSP("dbo.sp_custom_import_add_from_contract_subcon");												foreach($contract_subcon as $dt_data){							$data = array('contract_subcon_id'=>$dt_data);							$this->rpc_service->addAttributeChild('dt' ,$data);						}											break;										default:						$this->rpc_service->setSP("dbo.sp_custom_import_add");					break;				}			}												$this->rpc_service->addField('custom_type_id',$custom_type_id);			$this->rpc_service->addField('bc_in_type_id',$bc_in_type_id);			$this->rpc_service->addField('car',$car);			$this->rpc_service->addField('bc_no',$bc_no);			$this->rpc_service->addField('bc_date',$bc_date);			$this->rpc_service->addField('partner_id',$partner_id);								$this->rpc_service->addField('currencies_id',$currencies_id);						$this->rpc_service->addField('bongkar_port_id',$bongkar_port_id);						$this->rpc_service->addField('bongkar_kppbc_id',$bongkar_kppbc_id);						$this->rpc_service->addField('tujuan_tpb_id',$tujuan_tpb_id);						$this->rpc_service->addField('jenis_tpb_id',$jenis_tpb_id);						$this->rpc_service->addField('tujuan_pengiriman_id',$tujuan_pengiriman_id);						$this->rpc_service->addField('tujuan_pemasukan_id',$tujuan_pemasukan_id);						$this->rpc_service->addField('pjt_status_id',$pjt_status_id);						$this->rpc_service->addField('cara_angkut_id',$cara_angkut_id);						$this->rpc_service->addField('nama_pengangkut',$nama_pengangkut);						$this->rpc_service->addField('nomor_voy_flight',$nomor_voy_flight);						$this->rpc_service->addField('kode_bendera',$kode_bendera);						$this->rpc_service->addField('nomor_polisi',$nomor_polisi);						$this->rpc_service->addField('ndpbm',$ndpbm);						$this->rpc_service->addField('price_type_id',$price_type_id);						$this->rpc_service->addField('amount_origin',$amount_origin);						$this->rpc_service->addField('value_additional',$value_additional);						$this->rpc_service->addField('discount',$discount);						$this->rpc_service->addField('insurance_type_id',$insurance_type_id);						$this->rpc_service->addField('amount_insurance',$amount_insurance);						$this->rpc_service->addField('amount_freight',$amount_freight);						$this->rpc_service->addField('maklon',$maklon);						$this->rpc_service->addField('tps_id',$tps_id);						$this->rpc_service->addField('muat_port_id',$muat_port_id);						$this->rpc_service->addField('transit_port_id',$transit_port_id);						$this->rpc_service->addField('vendor_partner_id',$vendor_partner_id);									$result = $this->rpc_service->resultJSON();						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$data_result = json_decode($result['data'],true);														$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];							$return['bc_in_header_id'] = $data_result['bc_in_header_id'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}		function loaddata_detail(){		$this->authentication->plainlayout();				$bc_in_header_id = isset($_REQUEST['bc_in_header_id']) ? is_numeric($_REQUEST['bc_in_header_id']) ? $_REQUEST['bc_in_header_id']  : -1 : -1;		$methodid = isset($_REQUEST['methodid']) ? is_numeric($_REQUEST['methodid']) ? $_REQUEST['methodid']  : -1 : -1;				$view = 'view_custom_import_detail';		$field = $this->custom_import_detail_table();				$return = array();		$return['valid'] = false;		$return['message'] = "Internal Server Error";				$extra_param = array();		$extra_param['where']['0']['field'] = 'r2';		$extra_param['where']['0']['data'] = $bc_in_header_id;		$extra_param['methodid'] = $methodid;				$loaddata = $this->ecc_library->get_field_data($view,$field,$extra_param);					echo $loaddata;	}	function post_add_edit_detail(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();				$bc_in_barang_id = isset($_POST['bc_in_barang_id']) ? $_POST['bc_in_barang_id'] : false;		$bc_in_header_id = isset($_POST['bc_in_header_id']) ? $_POST['bc_in_header_id'] : 0;		$seri = isset($_POST['seri']) ? $_POST['seri'] : 0;		$item_id = isset($_POST['item_id']) ? $_POST['item_id'] : '';		$hs_id = isset($_POST['hs_id']) ? $_POST['hs_id'] : '';		$kategori_barang_id = isset($_POST['kategori_barang_id']) ? $_POST['kategori_barang_id'] : '';		$quantity_custom = isset($_POST['quantity_custom']) ? $_POST['quantity_custom'] : '';		$uom_id = isset($_POST['uom_id']) ? $_POST['uom_id'] : '';		$conversion = isset($_POST['conversion']) ? $_POST['conversion'] : '';		$unit_price = isset($_POST['unit_price']) ? $_POST['unit_price'] : '';		$merk = isset($_POST['merk']) ? $_POST['merk'] : '';		$tipe = isset($_POST['tipe']) ? $_POST['tipe'] : '';		$ukuran = isset($_POST['ukuran']) ? $_POST['ukuran'] : '';		$volume = isset($_POST['volume']) ? $_POST['volume'] : '';		$spesifikasi_lain = isset($_POST['spesifikasi_lain']) ? $_POST['spesifikasi_lain'] : '';		$bruto = isset($_POST['bruto']) ? $_POST['bruto'] : '';		$netto = isset($_POST['netto']) ? $_POST['netto'] : '';		$quantity_package = isset($_POST['quantity_package']) ? $_POST['quantity_package'] : '';		$package_id = isset($_POST['package_id']) ? $_POST['package_id'] : '';		$origin_country_id = isset($_POST['origin_country_id']) ? $_POST['origin_country_id'] : '';		$fasilitas_id = isset($_POST['fasilitas_id']) ? $_POST['fasilitas_id'] : '';		$skema_tarif_id = isset($_POST['skema_tarif_id']) ? $_POST['skema_tarif_id'] : '';		$bm_jenis_tarif_id = isset($_POST['bm_jenis_tarif_id']) ? $_POST['bm_jenis_tarif_id'] : '';		$bm_tarif = isset($_POST['bm_tarif']) ? $_POST['bm_tarif'] : '';		$bm_uom_id = isset($_POST['bm_uom_id']) ? $_POST['bm_uom_id'] : '';		$cukai_jenis_tarif_id = isset($_POST['cukai_jenis_tarif_id']) ? $_POST['cukai_jenis_tarif_id'] : '';		$cukai_tarif = isset($_POST['cukai_tarif']) ? $_POST['cukai_tarif'] : '';		$cukai_uom_id = isset($_POST['cukai_uom_id']) ? $_POST['cukai_uom_id'] : '';		$ppn_tarif = isset($_POST['ppn_tarif']) ? $_POST['ppn_tarif'] : '';		$pph_tarif = isset($_POST['pph_tarif']) ? $_POST['pph_tarif'] : '';		$ppnbm_tarif = isset($_POST['ppnbm_tarif']) ? $_POST['ppnbm_tarif'] : '';		$note = isset($_POST['note']) ? $_POST['note'] : '';				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){			if($bc_in_barang_id){				$this->rpc_service->setSP("dbo.sp_custom_import_detail_edit");				$this->rpc_service->addField('bc_in_barang_id',$bc_in_barang_id);			} else {				$this->rpc_service->setSP("dbo.sp_custom_import_detail_add");			}						$this->rpc_service->addField('bc_in_header_id',$bc_in_header_id);						$this->rpc_service->addField('seri',$seri);			$this->rpc_service->addField('item_id',$item_id);			$this->rpc_service->addField('hs_id',$hs_id);			$this->rpc_service->addField('kategori_barang_id',$kategori_barang_id);			$this->rpc_service->addField('quantity_custom',$quantity_custom);			$this->rpc_service->addField('uom_id',$uom_id);			$this->rpc_service->addField('conversion',$conversion);			$this->rpc_service->addField('unit_price',$unit_price);			$this->rpc_service->addField('merk',$merk);			$this->rpc_service->addField('tipe',$tipe);			$this->rpc_service->addField('ukuran',$ukuran);			$this->rpc_service->addField('volume',$volume);			$this->rpc_service->addField('spesifikasi_lain',$spesifikasi_lain);			$this->rpc_service->addField('bruto',$bruto);			$this->rpc_service->addField('netto',$netto);			$this->rpc_service->addField('quantity_package',$quantity_package);			$this->rpc_service->addField('package_id',$package_id);			$this->rpc_service->addField('origin_country_id',$origin_country_id);			$this->rpc_service->addField('fasilitas_id',$fasilitas_id);			$this->rpc_service->addField('skema_tarif_id',$skema_tarif_id);			$this->rpc_service->addField('bm_jenis_tarif_id',$bm_jenis_tarif_id);			$this->rpc_service->addField('bm_tarif',$bm_tarif);			$this->rpc_service->addField('bm_uom_id',$bm_uom_id);			$this->rpc_service->addField('cukai_jenis_tarif_id',$cukai_jenis_tarif_id);			$this->rpc_service->addField('cukai_tarif',$cukai_tarif);			$this->rpc_service->addField('cukai_uom_id',$cukai_uom_id);			$this->rpc_service->addField('ppn_tarif',$ppn_tarif);			$this->rpc_service->addField('pph_tarif',$pph_tarif);			$this->rpc_service->addField('ppnbm_tarif',$ppnbm_tarif);			$this->rpc_service->addField('note',$note);						$result = $this->rpc_service->resultJSON();						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$data = json_decode($result['data'],TRUE);														$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];																		}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}		function delete_detail(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$bc_in_barang_id = isset($_POST['bc_in_barang_id']) ? $_POST['bc_in_barang_id'] : false;				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){						if($bc_in_barang_id){				$this->rpc_service->setSP("dbo.sp_custom_import_detail_delete");				$this->rpc_service->addField('bc_in_barang_id',$bc_in_barang_id);			}								$result = $this->rpc_service->resultJSON();			// print_r($result);						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}		function loaddata_performa(){		$this->authentication->plainlayout();				$partner_id = isset($_POST['partner_id']) ? is_numeric($_POST['partner_id']) ?  $_POST['partner_id'] : -1 : -1;		$currencies_id = isset($_POST['currencies_id']) ? is_numeric($_POST['currencies_id']) ?  $_POST['currencies_id'] : -1 : -1;				$view = 'view_purchase_performa_custom';		$field = $this->custom_import_detail_table();				$return = array();		$return['valid'] = false;		$return['message'] = "Internal Server Error";				$extra_param = array();		$extra_param['where']['0']['field'] = 'r4';		$extra_param['where']['0']['data'] = $partner_id;		$extra_param['where']['1']['field'] = 'r5';		$extra_param['where']['1']['data'] = $currencies_id;				$loaddata = $this->ecc_library->get_field_data($view,$field,$extra_param);					echo $loaddata;	}		function loaddata_purchase(){		$this->authentication->plainlayout();				$field = array();		$field[] = array('field' => 'purchase_order_id', 'title' => 'purchase_order_id');		$field[] = array('field' => 'purchase_order_no', 'title' => 'purchase_order_no');		$field[] = array('field' => 'purchase_order_date', 'title' => 'purchase_order_date');				$return = array();		$return['valid'] = false;		$return['message'] = "Internal Server Error";		$loaddata_table = array();				$partner_id = isset($_POST['partner_id']) ? is_numeric($_POST['partner_id']) ?  $_POST['partner_id'] : -1 : -1;		$currencies_id = isset($_POST['currencies_id']) ? is_numeric($_POST['currencies_id']) ?  $_POST['currencies_id'] : -1 : -1;				$view = 'dbo.view_purchase_order_custom';		$where = array();		$where['partner_id'] = $partner_id;		$where['currencies_id'] = $currencies_id;		$loaddata = $this->ecc_library->loaddata($view,$field,$where);					foreach($loaddata['data'] as $key => $value){						$new_row = array();			$new_row[] = $value[0];			$new_row[] = $value[1];			$new_row[] = $value[2];						$loaddata_table[$value[0]] = $new_row;		}							$loaddata['data'] = array();		foreach($loaddata_table as $value){						$data = array();			$data[] = $value[0];			$data[] = $value[1];			$data[] = $value[2];						$loaddata['data'][] = $data;		}				echo json_encode($loaddata);	}		function loaddata_contract_subcon(){		$this->authentication->plainlayout();				$partner_id = isset($_POST['partner_id']) ? is_numeric($_POST['partner_id']) ?  $_POST['partner_id'] : -1 : -1;		$currencies_id = isset($_POST['currencies_id']) ? is_numeric($_POST['currencies_id']) ?  $_POST['currencies_id'] : -1 : -1;				$view = 'view_subcon_in_custom_cmt';		$field = $this->custom_import_detail_table();				$return = array();		$return['valid'] = false;		$return['message'] = "Internal Server Error";				$extra_param = array();		$extra_param['where']['0']['field'] = 'r4';		$extra_param['where']['0']['data'] = $partner_id;		$extra_param['where']['1']['field'] = 'r5';		$extra_param['where']['1']['data'] = $currencies_id;				$loaddata = $this->ecc_library->get_field_data($view,$field,$extra_param);					echo $loaddata;	}			function send_to_ceisa(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$tpb_header_id = isset($_POST['tpb_header_id']) ? $_POST['tpb_header_id'] : false;		$custom_type_id = isset($_POST['custom_type_id']) ? $_POST['custom_type_id'] : false;				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){			$sp = "dbo.sp_ceisa_send_to_module";				if($tpb_header_id){				$this->rpc_service->setSP(array("sp"=> $sp,"mode"=>"1","debug"=>"1"));			}						$this->rpc_service->addField('tpb_header_id',$tpb_header_id);			$this->rpc_service->addField('custom_type_id',$custom_type_id);							$result = $this->rpc_service->resultJSON();			// print_r($result);						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}		function get_register_no(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$tpb_header_id = isset($_POST['tpb_header_id']) ? $_POST['tpb_header_id'] : false;		$custom_type_id = isset($_POST['custom_type_id']) ? $_POST['custom_type_id'] : false;				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){			$sp = "dbo.sp_ceisa_get_respon";				if($tpb_header_id){				$this->rpc_service->setSP(array("sp"=> $sp,"mode"=>"1","debug"=>"1"));			}						$this->rpc_service->addField('tpb_header_id',$tpb_header_id);			$this->rpc_service->addField('custom_type_id',$custom_type_id);							$result = $this->rpc_service->resultJSON();			// print_r($result);						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}		function cancel_send_ceisa(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$tpb_header_id = isset($_POST['tpb_header_id']) ? $_POST['tpb_header_id'] : false;		$custom_type_id = isset($_POST['custom_type_id']) ? $_POST['custom_type_id'] : false;				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){			$sp = "dbo.sp_ceisa_cancel_dokumen";				if($tpb_header_id){				$this->rpc_service->setSP(array("sp"=> $sp,"mode"=>"1","debug"=>"1"));			}						$this->rpc_service->addField('tpb_header_id',$tpb_header_id);			$this->rpc_service->addField('custom_type_id',$custom_type_id);							$result = $this->rpc_service->resultJSON();			// print_r($result);						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}}?>