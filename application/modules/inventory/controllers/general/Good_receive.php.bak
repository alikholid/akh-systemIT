?><?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');Class Good_receive extends CI_Controller { 	function __construct(){ 		parent::__construct(); 				$this->data_request = $_REQUEST;				$module = $this->router->module;		$directory = $this->router->directory;		$class = $this->router->class;		$method = $this->router->method;		$directory = trim(str_replace('../modules/'.$module ,'',str_replace('/controllers/','',$directory)),'/');				$this->module = $module;		if(trim($directory) != ''){			$this->directory = $directory;		} else {			$this->directory = '0';			$this->directory2 = '';		}		$this->class = $class;		$this->method = $method;	}		function good_receive_table() {		$view = 'view_grn';		$get_field = $this->ecc_library->get_field($view);				$get_field['r1']['hidden'] = true;		$get_field['r16']['hidden'] = true;		$get_field['r17']['hidden'] = true;		$get_field['r18']['hidden'] = true;		$get_field['r19']['hidden'] = true;		$get_field['r20']['hidden'] = true;		$get_field['r21']['hidden'] = true;				return $get_field;	}		function good_receive_detail_table() {		$view = 'view_grn_detail';		$get_field = $this->ecc_library->get_field($view);				$get_field['r1']['hidden'] = true;		$get_field['r2']['hidden'] = true;				// $get_field['r12']['hidden'] = true;		// $get_field['r13']['hidden'] = true;		// $get_field['r14']['hidden'] = true;		// $get_field['r15']['hidden'] = true;				$get_field['act']['sc'] = 'act';		$get_field['act']['title'] = '#';		$get_field['act']['bypassvalue'] = '';		$get_field['act']['ctype'] = 'text';		$get_field['act']['align'] = 'center';		$get_field['act']['search'] = false;		$get_field['act']['sortable'] = false;		$get_field['act']['formatter'] = 'formatOperations';		$get_field['act']['width'] = 300;				return $get_field;	}		function good_receive_custom_table() {		$view = 'view_custom_import_item';		$get_field = $this->ecc_library->get_field($view);				$get_field['r1']['hidden'] = true;		$get_field['r2']['hidden'] = true;				$get_field['r12']['hidden'] = true;		$get_field['r13']['hidden'] = true;		$get_field['r14']['hidden'] = true;		$get_field['r15']['hidden'] = true;		$get_field['r16']['hidden'] = true;		$get_field['r17']['hidden'] = true;				$get_field['r9']['editable'] = true;				$get_field['act']['sc'] = 'act';		$get_field['act']['title'] = '#';		$get_field['act']['bypassvalue'] = '';		$get_field['act']['ctype'] = 'text';		$get_field['act']['align'] = 'center';		$get_field['act']['search'] = false;		$get_field['act']['sortable'] = false;		$get_field['act']['formatter'] = 'formatOperations2';		$get_field['act']['width'] = 300;				return $get_field;	}		function good_receive_purchase_table() {		$view = 'view_purchase_order_grn';		$get_field = $this->ecc_library->get_field($view);				$get_field['r1']['hidden'] = true;		$get_field['r2']['hidden'] = true;				$get_field['r12']['hidden'] = true;		$get_field['r13']['hidden'] = true;		$get_field['r14']['hidden'] = true;		$get_field['r15']['hidden'] = true;		$get_field['r16']['hidden'] = true;		$get_field['r17']['hidden'] = true;				$get_field['r9']['editable'] = true;				$get_field['act']['sc'] = 'act';		$get_field['act']['title'] = '#';		$get_field['act']['bypassvalue'] = '';		$get_field['act']['ctype'] = 'text';		$get_field['act']['align'] = 'center';		$get_field['act']['search'] = false;		$get_field['act']['sortable'] = false;		$get_field['act']['formatter'] = 'formatOperations2';		$get_field['act']['width'] = 300;				return $get_field;	}		function index(){		$this->load->model('main');		$component['loadlayout'] = true;		$component['view_load'] = 'general/good_receive/view';		$component['view_load_form'] = 'general/good_receive/form';		$component['load_js'][] = 'general/good_receive/view';		$component['load_js'][] = 'general/good_receive/form';				$component['page_title'] = "Good Receive";				$dashboard_table = array();				$nav_button = array();		$nav_button[] = array('method_id' => 221,'title' => 'Add', 'icon' => 'fa fa-plus', 'load' => 'general/good_receive/function_add');		$nav_button[] = array('method_id' => 226,'title' => 'Add From Purchase', 'icon' => 'fa fa-pencil', 'load' => 'general/good_receive/function_add_from_purchase');		// $nav_button[] = array('method_id' => 226,'title' => 'Add From Contract', 'icon' => 'fa fa-pencil', 'load' => 'general/good_receive/function_add_from_purchase');		$nav_button[] = array('method_id' => 222,'title' => 'Edit', 'icon' => 'fa fa-pencil', 'load' => 'general/good_receive/function_edit');		$nav_button[] = array('method_id' => 224,'title' => 'Approve', 'icon' => 'fa fa-check', 'load' => 'general/good_receive/function_approve');		$nav_button[] = array('method_id' => 223,'title' => 'Delete', 'icon' => 'fa fa-trash-o', 'load' => 'general/good_receive/function_delete');		$nav_button[] = array('method_id' => 751,'title' => 'Cancel Approve', 'icon' => 'fa fa-cross', 'load' => 'general/good_receive/function_cancel_approve');		$nav_button[] = array('method_id' => 804,'title' => 'Print', 'icon' => 'fa fa-print', 'load' => 'general/good_receive/function_print');				$field = $this->good_receive_table();		$field_detail = $this->good_receive_detail_table();		$field_custom_item = $this->good_receive_custom_table();		$field_purchase_item = $this->good_receive_purchase_table();				$dashboard_table['nav_button'] = $nav_button;		$dashboard_table['field'] = $field;		$dashboard_table['field_detail'] = $field_detail;		$dashboard_table['field_detail_loaddata'] = 'loaddata_detail';		$dashboard_table['field_custom_item'] = $field_custom_item;		$dashboard_table['field_custom_item_loaddata'] = 'loaddata_custom_item';		$dashboard_table['field_purchase_item'] = $field_purchase_item;		$dashboard_table['field_purchase_item_loaddata'] = 'loaddata_purchase_item';				$component['dashboard_table'] = $dashboard_table;				$this->authentication->ajaxlayout($component);	}		function loaddata() {		$this->authentication->plainlayout();				$view = 'view_grn';		$field = $this->good_receive_table();				$return = array();		$return['valid'] = false;		$return['message'] = "Internal Server Error"; 		$loaddata = $this->ecc_library->get_field_data($view,$field);					echo $loaddata;	}		function approve(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$grn_id = isset($_POST['grn_id']) ? $_POST['grn_id'] : false;				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){						if($grn_id){				$this->rpc_service_portal->setSP("dbo.sp_grn_approve");				$this->rpc_service_portal->addField('grn_id',$grn_id);			}								$result = $this->rpc_service_portal->resultJSON();			// print_r($result);						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}		function cancel_approve(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$grn_id = isset($_POST['grn_id']) ? $_POST['grn_id'] : false;				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){						if($grn_id){				$this->rpc_service_portal->setSP("dbo.sp_grn_cancel_approve");				$this->rpc_service_portal->addField('grn_id',$grn_id);			}								$result = $this->rpc_service_portal->resultJSON();			// print_r($result);						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}		function delete(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$grn_id = isset($_POST['grn_id']) ? $_POST['grn_id'] : false;				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){						if($grn_id){				$this->rpc_service_portal->setSP("dbo.sp_grn_delete");				$this->rpc_service_portal->addField('grn_id',$grn_id);			}								$result = $this->rpc_service_portal->resultJSON();			// print_r($result);						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}			function post_add_edit(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$grn_id = isset($_POST['grn_id']) ? $_POST['grn_id'] : '';		$grn_no = isset($_POST['grn_no']) ? $_POST['grn_no'] : '';		$grn_date = isset($_POST['grn_date']) ? $_POST['grn_date'] : '';		$grn_type_id = isset($_POST['grn_type_id']) ? $_POST['grn_type_id'] : '';		$warehouse_id = isset($_POST['warehouse_id']) ? $_POST['warehouse_id'] : '';		$partner_id = isset($_POST['partner_id']) ? $_POST['partner_id'] : '';		$bc_in_header_id = isset($_POST['bc_in_header_id']) ? $_POST['bc_in_header_id'] : '';		$purchase_order_id = isset($_POST['purchase_order_id']) ? $_POST['purchase_order_id'] : '';		$quantity_received = isset($_POST['quantity_received']) ? $_POST['quantity_received'] : array();		$bc_in_barang_id = isset($_POST['bc_in_barang_id']) ? $_POST['bc_in_barang_id'] : array();		$no_surat_jalan = isset($_POST['no_surat_jalan']) ? $_POST['no_surat_jalan'] : '';		$tgl_surat_jalan = isset($_POST['tgl_surat_jalan']) ? $_POST['tgl_surat_jalan'] : '';						$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){						if($grn_id){				$this->rpc_service_portal->setSP("dbo.sp_grn_edit");				$this->rpc_service_portal->addField('grn_id',$grn_id);			} else {				$this->rpc_service_portal->setSP("dbo.sp_grn_add");			}								$this->rpc_service_portal->addField('grn_no',$grn_no);			$this->rpc_service_portal->addField('grn_date',$grn_date);			$this->rpc_service_portal->addField('warehouse_id',$warehouse_id);			$this->rpc_service_portal->addField('grn_type_id',$grn_type_id);			$this->rpc_service_portal->addField('partner_id',$partner_id);			$this->rpc_service_portal->addField('bc_in_header_id',$bc_in_header_id);			$this->rpc_service_portal->addField('purchase_order_id',$purchase_order_id);			$this->rpc_service_portal->addField('no_surat_jalan',$no_surat_jalan);			$this->rpc_service_portal->addField('tgl_surat_jalan',$tgl_surat_jalan);									$result = $this->rpc_service_portal->resultJSON();						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$data_result = json_decode($result['data'],true);														$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];							$return['grn_id'] = $data_result['grn_id'];							$return['grn_type_id'] = $data_result['grn_type_id'];							$return['partner_id'] = $data_result['partner_id'];							$return['bc_in_header_id'] = $data_result['bc_in_header_id'];							$return['purchase_order_id'] = $data_result['purchase_order_id'];							$return['new_grn'] = $data_result['new_grn'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}		function loaddata_detail(){		$this->authentication->plainlayout();				$grn_id = isset($_REQUEST['grn_id']) ? is_numeric($_REQUEST['grn_id']) ? $_REQUEST['grn_id']  : -1 : -1;		$methodid = isset($_REQUEST['methodid']) ? is_numeric($_REQUEST['methodid']) ? $_REQUEST['methodid']  : -1 : -1;				$view = 'view_grn_detail';		$field = $this->good_receive_detail_table();				$return = array();		$return['valid'] = false;		$return['message'] = "Internal Server Error";				$extra_param = array();		$extra_param['where']['0']['field'] = 'r2';		$extra_param['where']['0']['data'] = $grn_id;		$extra_param['methodid'] = $methodid;				$loaddata = $this->ecc_library->get_field_data($view,$field,$extra_param);					echo $loaddata;	}		function post_add_edit_detail(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();				$grn_id = isset($_POST['grn_id']) ? $_POST['grn_id'] : 0;		$grn_detail_id = isset($_POST['grn_detail_id']) ? $_POST['grn_detail_id'] : '';		$quantity_received = isset($_POST['quantity_received']) ? $_POST['quantity_received'] : 0;		$bc_in_barang_id = isset($_POST['bc_in_barang_id']) ? $_POST['bc_in_barang_id'] : '';		$purchase_order_detail_id = isset($_POST['purchase_order_detail_id']) ? $_POST['purchase_order_detail_id'] : '';		$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){			if($grn_detail_id){				$this->rpc_service_portal->setSP("dbo.sp_grn_detail_edit");				$this->rpc_service_portal->addField('grn_detail_id',$grn_detail_id);			} else {				$this->rpc_service_portal->setSP("dbo.sp_grn_detail_add");			}						$this->rpc_service_portal->addField('grn_id',$grn_id);			$this->rpc_service_portal->addField('quantity_received',$quantity_received);			$this->rpc_service_portal->addField('purchase_order_detail_id',$purchase_order_detail_id);			$this->rpc_service_portal->addField('bc_in_barang_id',$bc_in_barang_id);						$result = $this->rpc_service_portal->resultJSON();			$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$data = json_decode($result['data'],TRUE);														$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}		} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}		function delete_detail(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				$grn_detail_id = isset($_POST['grn_detail_id']) ? $_POST['grn_detail_id'] : '';		$user_id = $this->session->userdata('user_id');						if(count($_POST) > 0){						$this->rpc_service_portal->setSP("dbo.sp_grn_detail_delete");			$this->rpc_service_portal->addField('grn_detail_id',$grn_detail_id);						$result = $this->rpc_service_portal->resultJSON();											$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}		echo json_encode($return);	}		function loaddata_custom_item(){		$this->authentication->plainlayout();				$grn_detail_id = isset($_REQUEST['grn_detail_id']) ? $_REQUEST['grn_detail_id'] : '';		$partner_id = isset($_REQUEST['partner_id']) ? is_numeric($_REQUEST['partner_id']) ? $_REQUEST['partner_id']  : -1 : -1;		$bc_in_header_id = isset($_REQUEST['bc_in_header_id']) ? is_numeric($_REQUEST['bc_in_header_id']) ? $_REQUEST['bc_in_header_id']  : -1 : -1;		$purchase_order_id = isset($_REQUEST['purchase_order_id']) ? is_numeric($_REQUEST['purchase_order_id']) ? $_REQUEST['purchase_order_id']  : -1 : -1;		$methodid = isset($_REQUEST['methodid']) ? is_numeric($_REQUEST['methodid']) ? $_REQUEST['methodid']  : -1 : -1;				$field = $this->good_receive_custom_table();				$return = array();		$return['valid'] = false;		$return['message'] = "Internal Server Error";				$extra_param = array();		if($grn_detail_id){			$view = 'view_grn_detail_custom';			$extra_param['where']['0']['field'] = 'r17';			$extra_param['where']['0']['data'] = $grn_detail_id;		} else {			$view = 'view_custom_import_item';			$extra_param['where']['0']['field'] = 'r14';			$extra_param['where']['0']['data'] = $partner_id;			$extra_param['where']['1']['field'] = 'r15';			$extra_param['where']['1']['data'] = $bc_in_header_id;		}				$extra_param['field']['rh_id'] = $grn_detail_id;						$extra_param['methodid'] = $methodid;				$loaddata = $this->ecc_library->get_field_data($view,$field,$extra_param);					echo $loaddata;	}		function loaddata_purchase_item(){		$this->authentication->plainlayout();				$grn_detail_id = isset($_REQUEST['grn_detail_id']) ? $_REQUEST['grn_detail_id'] : '';		$partner_id = isset($_REQUEST['partner_id']) ? is_numeric($_REQUEST['partner_id']) ? $_REQUEST['partner_id']  : -1 : -1;		$bc_in_header_id = isset($_REQUEST['bc_in_header_id']) ? is_numeric($_REQUEST['bc_in_header_id']) ? $_REQUEST['bc_in_header_id']  : -1 : -1;		$purchase_order_id = isset($_REQUEST['purchase_order_id']) ? is_numeric($_REQUEST['purchase_order_id']) ? $_REQUEST['purchase_order_id']  : -1 : -1;		$methodid = isset($_REQUEST['methodid']) ? is_numeric($_REQUEST['methodid']) ? $_REQUEST['methodid']  : -1 : -1;				$field = $this->good_receive_custom_table();				$return = array();		$return['valid'] = false;		$return['message'] = "Internal Server Error";				$extra_param = array();		if($grn_detail_id){			$view = 'view_grn_detail_purchase';			$extra_param['where']['0']['field'] = 'r17';			$extra_param['where']['0']['data'] = $grn_detail_id;		} else {			$view = 'view_purchase_order_grn';			$extra_param['where']['0']['field'] = 'r14';			$extra_param['where']['0']['data'] = $partner_id;			$extra_param['where']['1']['field'] = 'r16';			$extra_param['where']['1']['data'] = $purchase_order_id;		}				$extra_param['field']['rh_id'] = $grn_detail_id;						$extra_param['methodid'] = $methodid;				$loaddata = $this->ecc_library->get_field_data($view,$field,$extra_param);					echo $loaddata;	}      function print_good_receive()   {      $grn_id = isset($_POST['grn_id']) ? $_POST['grn_id'] : false;      $format = isset($_POST['format']) ? $_POST['format'] : 'xlsx';      $user_id = $this->session->userdata('user_id');            $sp = "dbo.sp_rpt_slip_penerimaan_barang_masuk";      $this->rpc_service_portal->setSP(array("sp"=>$sp,"mode"=>"2","debug"=>"1"));      $this->rpc_service_portal->addField('grn_id',$grn_id);      $this->rpc_service_portal->addField('format',$format);      $this->rpc_service_portal->addField('temp_folder',sys_get_temp_dir());      $this->rpc_service_portal->addField('sort','item.item_code asc');              $result = $this->rpc_service_portal->resultPrint2();      echo json_encode($result);   }}?>