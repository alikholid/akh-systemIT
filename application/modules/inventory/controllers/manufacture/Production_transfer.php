<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
Class Production_transfer extends CI_Controller { 
	function __construct(){ 		parent::__construct(); 				$this->data_transfer = $_REQUEST;				$module = $this->router->module;		$directory = $this->router->directory;		$class = $this->router->class;		$method = $this->router->method;		$directory = trim(str_replace('../modules/'.$module ,'',str_replace('/controllers/','',$directory)),'/');				$this->module = $module;		if(trim($directory) != ''){			$this->directory = $directory;		} else {			$this->directory = '0';			$this->directory2 = '';		}		$this->class = $class;		$this->method = $method;	}		function work_order_transfer_table() {		$view = 'view_work_order_transfer';		$get_field = $this->ecc_library->get_field($view);				$get_field['r1']['hidden'] = true;		$get_field['r13']['hidden'] = true;				return $get_field;	}		function work_order_transfer_detail_table() {		$view = 'view_work_order_request_list';		$get_field = $this->ecc_library->get_field($view);				$get_field['r1']['hidden'] = true;		$get_field['r2']['hidden'] = true;				return $get_field;	}		function work_order_transfer_detail_supply_table() {		$view = 'view_work_order_request_list';		$get_field = $this->ecc_library->get_field($view);				$get_field['r1']['hidden'] = true;		$get_field['r2']['hidden'] = true;				return $get_field;	}		function work_order_transfer_item_table() {		$view = 'view_stock_move_item_transfer';		$get_field = $this->ecc_library->get_field($view);		$get_field['r1']['hidden'] = true;		$get_field['r12']['hidden'] = true;				$get_field['r6']['footer'] = 'Total Stock :';		$get_field['r7']['footer'] = 'sum';		// $get_field['r1']['width'] = 450;				return $get_field;	}		function work_order_supply_item_table() {		$view = 'view_stock_move_supply_transfer';		$get_field = $this->ecc_library->get_field($view);		$get_field['r1']['hidden'] = true;		$get_field['r7']['hidden'] = true;		$get_field['r12']['hidden'] = true;		$get_field['r13']['hidden'] = true;		$get_field['r14']['hidden'] = true;				return $get_field;	}		function index(){		$this->load->model('main');		$component['loadlayout'] = true;		$component['view_load'] = 'manufacture/production_transfer/view';		$component['view_load_form'] = 'manufacture/production_transfer/form';		$component['load_js'][] = 'manufacture/production_transfer/view';		$component['load_js'][] = 'manufacture/production_transfer/form';				$component['page_title'] = "Production Transfer";				$dashboard_table = array();				$nav_button = array();		$nav_button[] = array('method_id' => 510,'title' => 'Add', 'icon' => 'fa fa-plus', 'load' => 'manufacture/production_transfer/function_add');		$nav_button[] = array('method_id' => 511,'title' => 'Edit', 'icon' => 'fa fa-pencil', 'load' => 'manufacture/production_transfer/function_edit');		$nav_button[] = array('method_id' => 518,'title' => 'Supply', 'icon' => 'fa fa-pencil', 'load' => 'manufacture/production_transfer/function_supply');		$nav_button[] = array('method_id' => 514,'title' => 'Approve', 'icon' => 'fa fa-pencil', 'load' => 'manufacture/production_transfer/function_approve');		$nav_button[] = array('method_id' => 513,'title' => 'Delete', 'icon' => 'fa fa-trash-o', 'load' => 'manufacture/production_transfer/function_delete');		$nav_button[] = array('method_id' => 771,'title' => 'Cancel Approve', 'icon' => 'fa fa-pencil', 'load' => 'manufacture/production_transfer/function_cancel_approve');		$nav_button[] = array('method_id' => 716,'title' => 'Print', 'icon' => 'fa fa-print', 'load' => 'manufacture/production_transfer/function_print');				$field = $this->work_order_transfer_table();		$field_detail = $this->work_order_transfer_detail_table();		$field_detail_supply = $this->work_order_transfer_detail_supply_table();		$field_transfer_item = $this->work_order_transfer_item_table();		$field_supply_item = $this->work_order_supply_item_table();				$dashboard_table['nav_button'] = $nav_button;		$dashboard_table['field'] = $field;		$dashboard_table['field_detail'] = $field_detail;		$dashboard_table['field_detail_supply'] = $field_detail_supply;		$dashboard_table['field_detail_loaddata'] = 'loaddata_detail';		$dashboard_table['field_detail_supply_loaddata'] = 'loaddata_detail';		$dashboard_table['field_transfer_item'] = $field_transfer_item;		$dashboard_table['field_transfer_item_loaddata'] = 'loaddata_transfer_item';		$dashboard_table['field_supply_item'] = $field_supply_item;		$dashboard_table['field_supply_item_loaddata'] = 'loaddata_supply_item';				$component['dashboard_table'] = $dashboard_table;				$this->authentication->ajaxlayout($component);	}		function loaddata() {		$this->authentication->plainlayout();				$view = 'view_work_order_transfer';		$field = $this->work_order_transfer_table();				$return = array();		$return['valid'] = false;		$return['message'] = "Internal Server Error"; 		$loaddata = $this->ecc_library->get_field_data($view,$field);					echo $loaddata;	}		function delete(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$work_order_transfer_id = isset($_POST['work_order_transfer_id']) ? $_POST['work_order_transfer_id'] : false;				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){						if($work_order_transfer_id){				$this->rpc_service->setSP("dbo.sp_work_order_transfer_delete");				$this->rpc_service->addField('work_order_transfer_id',$work_order_transfer_id);			}								$result = $this->rpc_service->resultJSON();			// print_r($result);						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}		function approve(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$work_order_transfer_id = isset($_POST['work_order_transfer_id']) ? $_POST['work_order_transfer_id'] : false;				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){						if($work_order_transfer_id){				$this->rpc_service->setSP("dbo.sp_work_order_transfer_approve");				$this->rpc_service->addField('work_order_transfer_id',$work_order_transfer_id);			}								$result = $this->rpc_service->resultJSON();			// print_r($result);						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}		function cancel_approve(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$work_order_transfer_id = isset($_POST['work_order_transfer_id']) ? $_POST['work_order_transfer_id'] : false;				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){						if($work_order_transfer_id){				$this->rpc_service->setSP("dbo.sp_work_order_transfer_cancel_approve");				$this->rpc_service->addField('work_order_transfer_id',$work_order_transfer_id);			}								$result = $this->rpc_service->resultJSON();			// print_r($result);						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}		function post_add_edit(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();										$work_order_transfer_id = isset($_POST['work_order_transfer_id']) ? $_POST['work_order_transfer_id'] : '';		$work_order_transfer_no = isset($_POST['work_order_transfer_no']) ? $_POST['work_order_transfer_no'] : '';		$work_order_transfer_date = isset($_POST['work_order_transfer_date']) ? $_POST['work_order_transfer_date'] : '';		$work_order_request_id = isset($_POST['work_order_request_id']) ? $_POST['work_order_request_id'] : '';				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){			if($work_order_transfer_id){				$this->rpc_service->setSP("dbo.sp_work_order_transfer_edit");				$this->rpc_service->addField('work_order_transfer_id',$work_order_transfer_id);			} else {				$this->rpc_service->setSP("dbo.sp_work_order_transfer_add");			}						$this->rpc_service->addField('work_order_transfer_no',$work_order_transfer_no);			$this->rpc_service->addField('work_order_transfer_date',$work_order_transfer_date);			$this->rpc_service->addField('work_order_request_id',$work_order_request_id);						$result = $this->rpc_service->resultJSON();							$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}		function loaddata_detail(){		$this->authentication->plainlayout();				$work_order_request_id = isset($_REQUEST['work_order_request_id']) ? is_numeric($_REQUEST['work_order_request_id']) ? $_REQUEST['work_order_request_id']  : -1 : -1;		$methodid = isset($_REQUEST['methodid']) ? is_numeric($_REQUEST['methodid']) ? $_REQUEST['methodid']  : -1 : -1;				$view = 'view_work_order_request_list';		$field = $this->work_order_transfer_detail_table();		$return = array();		$return['valid'] = false;		$return['message'] = "Internal Server Error";				$extra_param = array();		$extra_param['where']['0']['field'] = 'r2';		$extra_param['where']['0']['data'] = $work_order_request_id;		$extra_param['methodid'] = $methodid;				$loaddata = $this->ecc_library->get_field_data($view,$field,$extra_param);					echo $loaddata;	}		function loaddata_transfer_item(){		$this->authentication->plainlayout();		//var_dump("disini");		$work_order_request_list_id = isset($_REQUEST['work_order_request_list_id']) ? is_numeric($_REQUEST['work_order_request_list_id']) ? $_REQUEST['work_order_request_list_id']  : -1 : -1;		$methodid = isset($_REQUEST['methodid']) ? is_numeric($_REQUEST['methodid']) ? $_REQUEST['methodid']  : -1 : -1;				$view = 'view_stock_move_item_transfer';		$field = $this->work_order_transfer_item_table();				$return = array();		$return['valid'] = false;		$return['message'] = "Internal Server Error";				$extra_param = array();		$extra_param['where']['0']['field'] = 'r12';		$extra_param['where']['0']['data'] = $work_order_request_list_id;		$extra_param['methodid'] = $methodid;		$extra_param['footer_data'] = true;		$extra_param['sp_sum'] = 'dbo.sp_work_order_transfer_item_sum';				$loaddata = $this->ecc_library->get_field_data($view,$field,$extra_param);					echo $loaddata;	}		function loaddata_supply_item(){		$this->authentication->plainlayout();				$work_order_request_list_id = isset($_REQUEST['work_order_request_list_id']) ? is_numeric($_REQUEST['work_order_request_list_id']) ? $_REQUEST['work_order_request_list_id']  : -1 : -1;		$work_order_transfer_id = isset($_REQUEST['work_order_transfer_id']) ? is_numeric($_REQUEST['work_order_transfer_id']) ? $_REQUEST['work_order_transfer_id']  : -1 : -1;		$methodid = isset($_REQUEST['methodid']) ? is_numeric($_REQUEST['methodid']) ? $_REQUEST['methodid']  : -1 : -1;				$view = 'view_stock_move_supply_transfer';		$field = $this->work_order_supply_item_table();				$return = array();		$return['valid'] = false;		$return['message'] = "Internal Server Error";				$extra_param = array();		$extra_param['where']['0']['field'] = 'r12';		$extra_param['where']['0']['data'] = $work_order_request_list_id;		$extra_param['where']['1']['field'] = 'r14';		$extra_param['where']['1']['data'] = $work_order_transfer_id;		$extra_param['methodid'] = $methodid;				$loaddata = $this->ecc_library->get_field_data($view,$field,$extra_param);					echo $loaddata;	}		function post_add_edit_detail(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();				$stock_move_id = isset($_POST['stock_move_id']) ? $_POST['stock_move_id'] : false;		$work_order_request_list_id = isset($_POST['work_order_request_list_id']) ? $_POST['work_order_request_list_id'] : 0;		$work_order_transfer_detail_id = isset($_POST['work_order_transfer_detail_id']) ? $_POST['work_order_transfer_detail_id'] : '';		$quantity_supply = isset($_POST['quantity_supply']) ? $_POST['quantity_supply'] : 0;		$work_order_transfer_id = isset($_POST['work_order_transfer_id']) ? $_POST['work_order_transfer_id'] : 0;				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){			if($work_order_transfer_detail_id){				$this->rpc_service->setSP("dbo.sp_work_order_transfer_supply_edit");				$this->rpc_service->addField('work_order_transfer_detail_id',$work_order_transfer_detail_id);			} else {				$this->rpc_service->setSP("dbo.sp_work_order_transfer_supply_add");			}						$this->rpc_service->addField('work_order_transfer_id',$work_order_transfer_id);			$this->rpc_service->addField('work_order_request_list_id',$work_order_request_list_id);			$this->rpc_service->addField('quantity_supply',$quantity_supply);			$this->rpc_service->addField('stock_move_id',$stock_move_id);						$result = $this->rpc_service->resultJSON();						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}		function auto_supply_fifo(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$work_order_transfer_id = isset($_POST['work_order_transfer_id']) ? $_POST['work_order_transfer_id'] : false;				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){						if($work_order_transfer_id){				$this->rpc_service->setSP("dbo.sp_work_order_transfer_supply_fifo");				$this->rpc_service->addField('work_order_transfer_id',$work_order_transfer_id);			}								$result = $this->rpc_service->resultJSON();			// print_r($result);						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}		function auto_supply_lifo(){		$this->authentication->plainlayout();		$parameter = array();		$return = array();						$work_order_transfer_id = isset($_POST['work_order_transfer_id']) ? $_POST['work_order_transfer_id'] : false;				$user_id = $this->session->userdata('user_id');				$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){						if($work_order_transfer_id){				$this->rpc_service->setSP("dbo.sp_work_order_transfer_supply_lifo");				$this->rpc_service->addField('work_order_transfer_id',$work_order_transfer_id);			}								$result = $this->rpc_service->resultJSON();			// print_r($result);						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}					} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}				echo json_encode($return);	}      function print_transfer(){            $work_order_transfer_id = isset($_POST['work_order_transfer_id']) ? $_POST['work_order_transfer_id'] : false;      $format = isset($_POST['format']) ? $_POST['format'] : 'xlsx';      $user_id = $this->session->userdata('user_id');            // $result = array();		// $return['valid'] = false;      // $return['status_code'] = 501;		// $return['message'] = "Internal Server Error";           $sp = "dbo.sp_rpt_slip_production_transfer";                  $this->rpc_service->setSP(array("sp"=>$sp,"mode"=>"2","debug"=>"1"));      $this->rpc_service->addField('work_order_transfer_id',$work_order_transfer_id);      $this->rpc_service->addField('format',$format);      $this->rpc_service->addField('temp_folder',sys_get_temp_dir());      $this->rpc_service->addField('sort','d.item_code asc');              $result = $this->rpc_service->resultPrint2();      echo json_encode($result);	}   
}?>