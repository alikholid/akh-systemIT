<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');Class Daily_output extends CI_Controller { 	function __construct(){ 		parent::__construct(); 				//$this->data_transfer = $_REQUEST;				$module = $this->router->module;		$directory = $this->router->directory;		$class = $this->router->class;		$method = $this->router->method;		$directory = trim(str_replace('../modules/'.$module ,'',str_replace('/controllers/','',$directory)),'/');				$this->module = $module;		if(trim($directory) != ''){			$this->directory = $directory;		} else {			$this->directory = '0';			$this->directory2 = '';		}		$this->class = $class;		$this->method = $method;	}			function table_daily_output(){		$field = array();		$field['r1'] = array('sc' => 'r1','ctype' => 'text', 'bypassvalue' => '', 'title' => 'ID');		$field['r2'] = array('sc' => 'r2','ctype' => 'text', 'bypassvalue' => '', 'title' => 'LINE');		$field['r3'] = array('sc' => 'r3','ctype' => 'date', 'bypassvalue' => '', 'title' => 'DATE');		$field['r4'] = array('sc' => 'r4','ctype' => 'text', 'bypassvalue' => '', 'title' => 'STYLE');		$field['r5'] = array('sc' => 'r5','ctype' => 'text', 'bypassvalue' => '', 'title' => 'PO');		$field['r33'] = array('sc' => 'r33','ctype' => 'text', 'bypassvalue' => '', 'title' => '1/2 JAM');		$field['r7'] = array('sc' => 'r7','ctype' => 'text', 'bypassvalue' => '', 'title' => 'PRICE');		$field['r34'] = array('sc' => 'r34','ctype' => 'text', 'bypassvalue' => '', 'title' => 'TARGET PRICE');		$field['r9'] = array('sc' => 'r9','ctype' => 'text', 'bypassvalue' => '', 'title' => 'TARGET PRODUKSI');		$field['r12'] = array('sc' => 'r12','ctype' => 'text', 'bypassvalue' => '', 'title' => '07:30');		$field['r13'] = array('sc' => 'r13','ctype' => 'text', 'bypassvalue' => '', 'title' => '08:00');		$field['r14'] = array('sc' => 'r14','ctype' => 'text', 'bypassvalue' => '', 'title' => '08:30');		$field['r15'] = array('sc' => 'r15','ctype' => 'text', 'bypassvalue' => '', 'title' => '09:00');		$field['r16'] = array('sc' => 'r16','ctype' => 'text', 'bypassvalue' => '', 'title' => '09:30');		$field['r17'] = array('sc' => 'r17','ctype' => 'text', 'bypassvalue' => '', 'title' => '10:00');		$field['r18'] = array('sc' => 'r18','ctype' => 'text', 'bypassvalue' => '', 'title' => '10:30');		$field['r19'] = array('sc' => 'r19','ctype' => 'text', 'bypassvalue' => '', 'title' => '11:00');		$field['r20'] = array('sc' => 'r20','ctype' => 'text', 'bypassvalue' => '', 'title' => '11:30');		$field['r21'] = array('sc' => 'r21','ctype' => 'text', 'bypassvalue' => '', 'title' => '13:00');		$field['r22'] = array('sc' => 'r22','ctype' => 'text', 'bypassvalue' => '', 'title' => '13:30');		$field['r23'] = array('sc' => 'r23','ctype' => 'text', 'bypassvalue' => '', 'title' => '14:00');		$field['r24'] = array('sc' => 'r24','ctype' => 'text', 'bypassvalue' => '', 'title' => '14:30');		$field['r25'] = array('sc' => 'r25','ctype' => 'text', 'bypassvalue' => '', 'title' => '15:00');		$field['r26'] = array('sc' => 'r26','ctype' => 'text', 'bypassvalue' => '', 'title' => '15:30');		$field['r27'] = array('sc' => 'r27','ctype' => 'text', 'bypassvalue' => '', 'title' => '16:00');		$field['r35'] = array('sc' => 'r35','ctype' => 'text', 'bypassvalue' => '', 'title' => 'OUTPUT');		$field['r36'] = array('sc' => 'r36','ctype' => 'text', 'bypassvalue' => '', 'title' => 'BLNC TRGT');		$field['r32'] = array('sc' => 'r32','ctype' => 'text', 'bypassvalue' => '', 'title' => 'REMARK');		$field['r37'] = array('sc' => 'r37','ctype' => 'text', 'bypassvalue' => '', 'title' => 'ID_LINE');		return $field;		//r10 dan r11	}		function index(){		//$this->load->model('main');		$component['loadlayout'] = true;		$component['view_load'] =  'manufacture/daily_output/view';		$component['view_load_form'] = 'manufacture/daily_output/form';		$component['load_js'][] = 'manufacture/daily_output/view';		$component['load_js'][] = 'manufacture/daily_output/js_dynamicLink';		//$component['load_js'][] = 'manufacture/daily_output/js_dynamicLink2';				$component['page_title'] = "Daily Output";		$dashboard_table = array();					$field = $this->table_daily_output();						$dashboard_table['field'] = $field;		 			$component['dashboard_table'] = $dashboard_table;				$this->authentication->ajaxlayout($component);	}		function index_old(){		$this->load->model('main');		$component['loadlayout'] = true;		$component['view_load'] = 'manufacture/production_transfer/view';		$component['view_load_form'] = 'manufacture/production_transfer/form';		$component['load_js'][] = 'manufacture/production_transfer/view';		$component['load_js'][] = 'manufacture/production_transfer/form';				$component['page_title'] = "Daily Output Sewing";				$dashboard_table = array();				$nav_button = array();		$nav_button[] = array('method_id' => 510,'title' => 'Add', 'icon' => 'fa fa-plus', 'load' => 'manufacture/production_transfer/function_add');		$nav_button[] = array('method_id' => 511,'title' => 'Edit', 'icon' => 'fa fa-pencil', 'load' => 'manufacture/production_transfer/function_edit');		$nav_button[] = array('method_id' => 518,'title' => 'Supply', 'icon' => 'fa fa-pencil', 'load' => 'manufacture/production_transfer/function_supply');		$nav_button[] = array('method_id' => 514,'title' => 'Approve', 'icon' => 'fa fa-pencil', 'load' => 'manufacture/production_transfer/function_approve');		$nav_button[] = array('method_id' => 513,'title' => 'Delete', 'icon' => 'fa fa-trash-o', 'load' => 'manufacture/production_transfer/function_delete');		$nav_button[] = array('method_id' => 771,'title' => 'Cancel Approve', 'icon' => 'fa fa-pencil', 'load' => 'manufacture/production_transfer/function_cancel_approve');		$nav_button[] = array('method_id' => 716,'title' => 'Print', 'icon' => 'fa fa-print', 'load' => 'manufacture/production_transfer/function_print');				$field = $this->work_order_transfer_table();		$field_detail = $this->work_order_transfer_detail_table();		$field_detail_supply = $this->work_order_transfer_detail_supply_table();		$field_transfer_item = $this->work_order_transfer_item_table();		$field_supply_item = $this->work_order_supply_item_table();				$dashboard_table['nav_button'] = $nav_button;		$dashboard_table['field'] = $field;		$dashboard_table['field_detail'] = $field_detail;		$dashboard_table['field_detail_supply'] = $field_detail_supply;		$dashboard_table['field_detail_loaddata'] = 'loaddata_detail';		$dashboard_table['field_detail_supply_loaddata'] = 'loaddata_detail';		$dashboard_table['field_transfer_item'] = $field_transfer_item;		$dashboard_table['field_transfer_item_loaddata'] = 'loaddata_transfer_item';		$dashboard_table['field_supply_item'] = $field_supply_item;		$dashboard_table['field_supply_item_loaddata'] = 'loaddata_supply_item';				$component['dashboard_table'] = $dashboard_table;				$this->authentication->ajaxlayout($component);	}			function loaddata()   {	    $field = $this->table_daily_output();		//var_dump($field);die();						$cek=$_REQUEST['q'];		//var_dump($_POST['q']);        if ($cek =='0'){ 		// var_dump($cek);die();		 	 $id = isset($_REQUEST['id_daily']) ? $_REQUEST['id_daily'] : 0;	             $line = isset($_REQUEST['nama_line']) ? $_REQUEST['nama_line'] : 0;	             $date = isset($_REQUEST['date']) ? $_REQUEST['date'] : '';             $style = isset($_REQUEST['style_target']) ? $_REQUEST['style_target'] : '';             $po = isset($_REQUEST['po_target']) ? $_REQUEST['po_target'] : '';  			 $harga = isset($_REQUEST['harga']) ? $_REQUEST['harga'] : '';             $jam = isset($_REQUEST['jam']) ? $_REQUEST['jam'] : '';             $production = isset($_REQUEST['production_target']) ? $_REQUEST['production_target'] : '';  		     $hasil = isset($_REQUEST['hasil_target']) ? $_REQUEST['hasil_target'] : '';		     $print = isset($_REQUEST['print']) ? $_REQUEST['print'] : 0;		     $format = isset($_REQUEST['format']) ? $_REQUEST['format'] : 'xlsx';		     $page = isset($_POST['page'])?$_POST['page']:1; // get the requested page              $rows = isset($_POST['rows'])?$_POST['rows']:10; // get how many rows we want to have into the grid              $sidx = isset($_POST['sidx'])?$_POST['sidx']:'r2'; // get index row - i.e. user click to sort              $sord = isset($_POST['sord'])?$_POST['sord']:'0'; // get the direction 		     $search = isset($_REQUEST['_search'])?$_REQUEST['_search']:false; 		     $filterRules =  isset($_POST['filters'])?$_POST['filters']:false;			 			 		}else if ($cek =='3'){			 $style = isset($_REQUEST['style']) ? $_REQUEST['style'] : 0;             $po = isset($_REQUEST['po']) ? $_REQUEST['po'] : '';  			 $harga = isset($_REQUEST['harga']) ? $_REQUEST['harga'] : 0;			 $harga_satuan = isset($_REQUEST['harga_satuan']) ? $_REQUEST['harga_satuan'] : 0;             $jam = isset($_REQUEST['lama']) ? $_REQUEST['lama'] : '14';             $production = isset($_REQUEST['nilai_target']) ? $_REQUEST['nilai_target'] : 0;  		     $hasil = isset($_REQUEST['hasil_target']) ? $_REQUEST['hasil_target'] : 0;			 $new_style=isset($_REQUEST['new_style']) ? $_REQUEST['new_style'] : '';			             $date = isset($_REQUEST['tanggal']) ? $_REQUEST['tanggal'] : '';			 $id= isset($_REQUEST['id_daily']) ?  $_REQUEST['id_daily'] : 0;		     $line = isset($_REQUEST['line']) ?  $_REQUEST['line'] : 0;					     $print = isset($_REQUEST['print']) ? $_REQUEST['print'] : 0;		     $format = isset($_REQUEST['format']) ? $_REQUEST['format'] : 'xlsx';		     $page = isset($_POST['page'])?$_POST['page']:1; // get the requested page              $rows = isset($_POST['rows'])?$_POST['rows']:10; // get how many rows we want to have into the grid              $sidx = isset($_POST['sidx'])?$_POST['sidx']:'r2'; // get index row - i.e. user click to sort              $sord = isset($_POST['sord'])?$_POST['sord']:'0'; // get the direction 		     $search = isset($_REQUEST['_search'])?$_REQUEST['_search']:false; 		     $filterRules =  isset($_POST['filters'])?$_POST['filters']:false;		        }else{			 $style = isset($_REQUEST['style_target']) ? $_REQUEST['style_target'] : '';             $po = isset($_REQUEST['po_target']) ? $_REQUEST['po_target'] : '';  			 $harga = isset($_REQUEST['harga']) ? $_REQUEST['harga'] : '';             $jam = isset($_REQUEST['jam']) ? $_REQUEST['jam'] : '';             $production = isset($_REQUEST['production_target']) ? $_REQUEST['production_target'] : '';  		     $hasil = isset($_REQUEST['hasil_target']) ? $_REQUEST['hasil_target'] : '';			             $id= isset($_REQUEST['id_daily']) ?  $_REQUEST['id_daily'] : 0;		     $line = isset($_REQUEST['nama_line']) ?  $_REQUEST['nama_line'] : 0;					     $date = isset($_REQUEST['date']) ? $_REQUEST['date'] : '';		     $print = isset($_REQUEST['print']) ? $_REQUEST['print'] : 0;		     $format = isset($_REQUEST['format']) ? $_REQUEST['format'] : 'xlsx';		     $page = isset($_POST['page'])?$_POST['page']:1; // get the requested page              $rows = isset($_POST['rows'])?$_POST['rows']:10; // get how many rows we want to have into the grid              $sidx = isset($_POST['sidx'])?$_POST['sidx']:'r2'; // get index row - i.e. user click to sort              $sord = isset($_POST['sord'])?$_POST['sord']:'0'; // get the direction 		     $search = isset($_REQUEST['_search'])?$_REQUEST['_search']:false; 		     $filterRules =  isset($_POST['filters'])?$_POST['filters']:false;		}		//var_dump($date);		$limit =  $rows;		$offset =  $rows * ($page - 1);		$order = isset($_REQUEST['order']) ? $_REQUEST['order'] : array();				if($sord == 'asc'){			$sord = 1;		} else {			$sord = 2;		}				$sort =	$sidx. '='.$sord;							if(strlen(trim($date)) == 0 ){			$date_start = '1900-01-01';		}			$return = array();		$return['valid'] = false;		$return['message'] = "Internal Server Error";         if ($cek =='0'){ 		   $sp = "dbo.sp_target_production";		   unset($_POST);		 }else if ($cek =='2'){		   $sp = "dbo.sp_daily_copy";		   unset($_POST);		 }else if($cek =='3'){			$sp = "dbo.sp_daily_add";			//unset($_REQUEST); 		   // unset($_POST);		 }else{		   $sp = "dbo.sp_daily_output";		}						if($print == 1){			$this->rpc_service->setSP(array("sp"=> $sp,"mode"=> $print == 1 ? "2" : "1","debug"=>"1"));		} else {			$this->rpc_service->setSP($sp);		}	//	 $id = isset($_REQUEST['id_target']) ? $_REQUEST['id_target'] : '';	    //         $line = isset($_REQUEST['line_target']) ? $_REQUEST['line_target'] : '';	    //         $date = isset($_REQUEST['date_target']) ? $_REQUEST['date_target'] : '';    //         $style = isset($_REQUEST['style_target']) ? $_REQUEST['style_target'] : '';    //         $po = isset($_REQUEST['po_target']) ? $_REQUEST['po_target'] : '';  	//		 $harga = isset($_REQUEST['harga']) ? $_REQUEST['harga'] : '';    //         $jam = isset($_REQUEST['jam']) ? $_REQUEST['jam'] : '';    //         $production = isset($_REQUEST['production_target']) ? $_REQUEST['production_target'] : '';  	//	     $hasil = isset($_REQUEST['hasil_target']) ? $_REQUEST['hasil_target'] : '';	//	     $print = isset($_REQUEST['print']) ? $_REQUEST['print'] : 0;	    if ($cek =='3'){		     $this->rpc_service->addField('jam',$jam);			 $this->rpc_service->addField('harga_satuan',$harga_satuan);			 $this->rpc_service->addField('new_style',$new_style);			// $_REQUEST['q']=1;			 $cek=1;	    }			    $this->rpc_service->addField('id_daily',$id);		$this->rpc_service->addField('nama_line',$line);		$this->rpc_service->addField('date_daily',$date);		$this->rpc_service->addField('style_daily',$style);		$this->rpc_service->addField('po',$po);		$this->rpc_service->addField('harga',$harga);		$this->rpc_service->addField('jam',$jam);		$this->rpc_service->addField('production',$production);		$this->rpc_service->addField('hasil',$hasil);		$this->rpc_service->addField('format',$format);		$this->rpc_service->addField('temp_folder',sys_get_temp_dir());		$this->rpc_service->addField('sort',$sort);		$this->rpc_service->addField('limit',$limit);		$this->rpc_service->addField('offset',$offset);				$this->rpc_service->setWhere($search,$filterRules,$field);				if($print == 1){			$result = $this->rpc_service->Print_absensi_1('','','','',$format,$date,$karyawan_name,$departemen); 		   echo json_encode($result);		} else {			$this->authentication->plainlayout();									$result = $this->rpc_service->resultJSON_pop();				$data_result = json_decode($result['data'],true);		   // var_dump($data_result['detail']);			if(isset($data_result['detail']['result_count'])){				$records = $data_result['detail']['result_count'];				$total = ceil($data_result['detail']['result_count'] / $limit);			} else {				$records = 0;				$total = 0;			}						$responce = new stdclass();			$responce->page = $page;			$responce->records = $records;			$responce->total = $total;			$i=0; 			if($data_result){				if(isset($data_result['xrow'])){					foreach($data_result['xrow'] as $key=>$value){						foreach ($value as $k => $v) {							$responce->rows[$i][$k] = $v;						} 						$i++;					}				}			}					echo json_encode($responce);		}	  	}		function target_edit_add(){	//	$this->authentication->plainlayout();	//	$return = array();			  	$date_target = isset($_POST['date_target2']) ? $_POST['date_target2'] : '';		//var_dump($date_target);			$return['message'] = $date_target;		echo json_encode($return);	}	function add_edit_target(){	    $this->authentication->plainlayout();		$return = array();			  	$date_target = isset($_POST['date_target2']) ? $_POST['date_target2'] : '';		$style_target = isset($_POST['style_target2']) ? $_POST['style_target2'] : '';		$po_target = isset($_POST['po_target2']) ? $_POST['po_target2'] : '';		$harga = isset($_POST['harga']) ? $_POST['harga'] : '';		$jam = isset($_POST['jam']) ? $_POST['jam'] : '';		$production_target = isset($_POST['production_target']) ? $_POST['production_target'] : 0;		$hasil_target = isset($_POST['hasil_target']) ? $_POST['hasil_target'] : '';				$user_id = $this->session->userdata('user_id');				//var_dump($style_target);		if($style_target !='-'){			if($style_target){				// var_dump($absen_id);				$this->rpc_service->setSP("dbo.sp_target");				//$this->rpc_service->addField('absen_id',$absen_id);			} else {			//	$this->rpc_service->setSP("dbo.sp_karyawan_absen_add");				$this->rpc_service->setSP("dbo.sp_target");				$this->rpc_service->addField('absen_id','');				//$this->load->model('main');		   	}						//$this->rpc_service->addField('karyawan_id',$karyawan_id);		    $this->rpc_service->addField('tanggal_target',$date_target);			$this->rpc_service->addField('style_target',$style_target);			$this->rpc_service->addField('po_target',$po_target);			$this->rpc_service->addField('harga_target',$harga);			$this->rpc_service->addField('jam_target',$jam);			$this->rpc_service->addField('production_target',$production_target);			$this->rpc_service->addField('hasil_target',$hasil_target);									$result = $this->rpc_service->resultJSON_pop();			//var_dump($result['data']);die();			$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$data_result = json_decode($result['data'],TRUE);														$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];							$return['hasil'] = $data_result['hasil'];							$return['style'] = $data_result['style'];							//$return['tanggal_absen'] = $data_result['tanggal_absen'];							//$return['keterangan_absen'] = $data_result['keterangan_absen'];													}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}							}else {			$return['valid'] = false;			$return['message'] = "Session expired";		}						echo json_encode($return);   }      function print_transfer(){            $work_order_transfer_id = isset($_POST['work_order_transfer_id']) ? $_POST['work_order_transfer_id'] : false;      $format = isset($_POST['format']) ? $_POST['format'] : 'xlsx';      $user_id = $this->session->userdata('user_id');            // $result = array();		// $return['valid'] = false;      // $return['status_code'] = 501;		// $return['message'] = "Internal Server Error";           $sp = "dbo.sp_rpt_slip_production_transfer";                  $this->rpc_service->setSP(array("sp"=>$sp,"mode"=>"2","debug"=>"1"));      $this->rpc_service->addField('work_order_transfer_id',$work_order_transfer_id);      $this->rpc_service->addField('format',$format);      $this->rpc_service->addField('temp_folder',sys_get_temp_dir());      $this->rpc_service->addField('sort','d.item_code asc');              $result = $this->rpc_service->resultPrint2();      echo json_encode($result);	}   }?>