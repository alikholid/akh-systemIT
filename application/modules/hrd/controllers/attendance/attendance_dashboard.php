<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');Class Attendance_dashboard extends CI_Controller { 	function __construct()   { 		parent::__construct(); 				$this->data_request = $_REQUEST;				$module = $this->router->module;		$directory = $this->router->directory;		$class = $this->router->class;		$method = $this->router->method;		$directory = trim(str_replace('../modules/'.$module ,'',str_replace('/controllers/','',$directory)),'/');		//var_dump($directory);		$this->module = $module;		if(trim($directory) != ''){			$this->directory = $directory;		} else {			$this->directory = '0';			$this->directory2 = '';		}		$this->class = $class;		$this->method = $method;	}			function table_report(){		$field = array();		$field['r1'] = array('sc' => 'r1','ctype' => 'text', 'bypassvalue' => '', 'title' => 'ID');		$field['r2'] = array('sc' => 'r2','ctype' => 'text', 'bypassvalue' => '', 'title' => 'ID ABSEN');		$field['r3'] = array('sc' => 'r3','ctype' => 'text', 'bypassvalue' => '', 'title' => 'NAME');		$field['r4'] = array('sc' => 'r4','ctype' => 'text', 'bypassvalue' => '', 'title' => 'DEPARTEMENT');		$field['r5'] = array('sc' => 'r5','ctype' => 'time', 'bypassvalue' => '', 'title' => 'DIVISI');		$field['r6'] = array('sc' => 'r6','ctype' => 'time', 'bypassvalue' => '', 'title' => 'SUB DIVISI');		$field['r7'] = array('sc' => 'r7','ctype' => 'text', 'bypassvalue' => '', 'title' => 'WORKING TIME');		$field['r8'] = array('sc' => 'r8','ctype' => 'text', 'bypassvalue' => '', 'title' => 'YEAR');		$field['r9'] = array('sc' => 'r9','ctype' => 'text', 'bypassvalue' => '', 'title' => 'TOTAL HOURS');		$field['r10'] = array('sc' => 'r10','ctype' => 'text', 'bypassvalue' => '', 'title' => 'IN');		$field['r11'] = array('sc' => 'r11','ctype' => 'text', 'bypassvalue' => '', 'title' => 'LEAVE');		$field['r12'] = array('sc' => 'r12','ctype' => 'text', 'bypassvalue' => '', 'title' => 'SICK');		$field['r13'] = array('sc' => 'r13','ctype' => 'text', 'bypassvalue' => '', 'title' => 'P2');		$field['r14'] = array('sc' => 'r14','ctype' => 'text', 'bypassvalue' => '', 'title' => 'P3');		$field['r15'] = array('sc' => 'r15','ctype' => 'text', 'bypassvalue' => '', 'title' => 'SD');		$field['r16'] = array('sc' => 'r16','ctype' => 'text', 'bypassvalue' => '', 'title' => 'DS');		$field['r17'] = array('sc' => 'r17','ctype' => 'text', 'bypassvalue' => '', 'title' => 'DL');		$field['r18'] = array('sc' => 'r18','ctype' => 'text', 'bypassvalue' => '', 'title' => 'M');		$field['r19'] = array('sc' => 'r19','ctype' => 'text', 'bypassvalue' => '', 'title' => 'PC');		$field['r20'] = array('sc' => 'r20','ctype' => 'text', 'bypassvalue' => '', 'title' => 'IP');		$field['r21'] = array('sc' => 'r21','ctype' => 'text', 'bypassvalue' => '', 'title' => 'TM');		$field['r22'] = array('sc' => 'r22','ctype' => 'text', 'bypassvalue' => '', 'title' => 'TP');		return $field;	}		function table_report_keterangan(){		$field = array();		$field['r1'] = array('sc' => 'r1','ctype' => 'text', 'bypassvalue' => '', 'title' => 'TANGGAL');		$field['r2'] = array('sc' => 'r2','ctype' => 'text', 'bypassvalue' => '', 'title' => 'ID ABSEN');		$field['r3'] = array('sc' => 'r3','ctype' => 'text', 'bypassvalue' => '', 'title' => 'NAME');		$field['r4'] = array('sc' => 'r4','ctype' => 'time', 'bypassvalue' => '', 'title' => 'MASUK');		$field['r5'] = array('sc' => 'r5','ctype' => 'time', 'bypassvalue' => '', 'title' => 'KELUAR');		$field['r6'] = array('sc' => 'r6','ctype' => 'text', 'bypassvalue' => '', 'title' => 'KETERANGAN');		return $field;	}		function index(){		$this->load->model('main');		$component['loadlayout'] = true;		$component['view_load'] = 'attendance/view';		$component['load_js'][] = 'attendance/view';		//$component['load_js'][] = 'absensi/js_dynamicLink';		//$component['load_js'][] = 'absensi/jquery_fmatter';					//$date1 = isset($_REQUEST['chart_date1']) ? $_REQUEST['chart_date1'] : '';				$component['page_title'] = "Dashboard";				//========= Untuk cek jumlah keterangan ===========		$date_start = date("Y-m-d");		$date_end = date("Y-m-d");		$cek= $this->main->cek_keterangan($date_start,$date_end );		$jml_hari=$this->main->selisihHari($date_start, $date_end); // Cek hari libur dan jumlah hari		$component['jml_hari']=$jml_hari+1;		//var_dump($cek[0]);		//$date_end = isset($_REQUEST['date_end']) ? $_REQUEST['date_end'] : '';				//karyawan_lama_kerja = $('#form_ echo $methodid _karyawan_lama_kerja').val();				$component['jumlah_M'] = $cek[0]['jml_M'];		$component['jumlah_S'] = $cek[0]['jml_S'];		$component['jumlah_cuti'] = $cek[0]['jml_cuti'];		$component['jumlah_cuti_lahir'] = $cek[0]['jml_cuti_lahir'];		$component['jumlah_P2'] = $cek[0]['jml_P2'];		$component['jumlah_P3'] = $cek[0]['jml_P3'];		$component['jumlah_IP'] = $cek[0]['jml_IP'];		$component['jumlah_SD'] = $cek[0]['jml_SD'];		$component['jumlah_T'] = $cek[0]['jml_T'];		$component['jumlah_DL'] = $cek[0]['jml_DL'];		$component['jumlah_TM'] = $cek[0]['jml_TM'];		$component['jumlah_TP'] = $cek[0]['jml_TP'];		$component['jumlah_PC'] = $cek[0]['jml_PC'];								$dashboard_table = array();								$this->authentication->ajaxlayout($component);	}			 function loaddata_dashboard_M()   {	   	$field_report = $this->table_report();	    $this->load->model('main');					   // $karyawan_name = isset($_REQUEST['karyawan_name']) ?  $_REQUEST['karyawan_name'] : 0;	    $keterangan = isset($_REQUEST['ket']) ?  $_REQUEST['ket'] : 'M';		$lama_kerja= isset($_REQUEST['karyawan_lama_kerja']) ?  $_REQUEST['karyawan_lama_kerja'] : 0;		$date_start = isset($_REQUEST['date_start']) ? $_REQUEST['date_start'] : '';		$date_end = isset($_REQUEST['date_end']) ? $_REQUEST['date_end'] : '';		$print = isset($_REQUEST['print']) ? $_REQUEST['print'] : 0;		$format = isset($_REQUEST['format']) ? $_REQUEST['format'] : 'xlsx';		$page = isset($_POST['page'])?$_POST['page']:1; // get the requested page         $rows = isset($_POST['rows'])?$_POST['rows']:10; // get how many rows we want to have into the grid         $sidx = isset($_POST['sidx'])?$_POST['sidx']:'r2'; // get index row - i.e. user click to sort         $sord = isset($_POST['sord'])?$_POST['sord']:'0'; // get the direction 		$search = isset($_REQUEST['_search'])?$_REQUEST['_search']:false; 		$filterRules =  isset($_POST['filters'])?$_POST['filters']:false;		//$imode='2';		//$date_end='2024-01-27';				$jml_hari=$this->main->selisihHari($date_start, $date_end); // Cek hari libur dan jumlah hari		$jml_hari=$jml_hari+1;		//var_dump($keterangan);				$limit =  $rows;		$offset =  $rows * ($page - 1);		$order = isset($_REQUEST['order']) ? $_REQUEST['order'] : array();				if($sord == 'asc'){			$sord = 1;		} else {			$sord = 2;		}				$sort =	$sidx. '='.$sord;							if(strlen(trim($date_start)) == 0 ){			$date_start = '1900-01-01';		}				if(strlen(trim($date_end)) == 0 ){			$date_end = '9999-12-31';		}							$return = array();		$return['valid'] = false;		$return['message'] = "Internal Server Error"; 		$sp = "dbo.sp_rpt_absensi_dashboard";				if($print == 1){			$this->rpc_service->setSP(array("sp"=> $sp,"mode"=> $print == 1 ? "2" : "1","debug"=>"1"));		} else {			$this->rpc_service->setSP($sp);		}				//$this->rpc_service->addField('karyawan_name',$karyawan_name);		$this->rpc_service->addField('keterangan',$keterangan);		$this->rpc_service->addField('lama_kerja',$lama_kerja);		$this->rpc_service->addField('date_start',$date_start);		$this->rpc_service->addField('date_end',$date_end);		$this->rpc_service->addField('jml_hari',$jml_hari);		$this->rpc_service->addField('format',$format);		$this->rpc_service->addField('temp_folder',sys_get_temp_dir());		$this->rpc_service->addField('sort',$sort);		$this->rpc_service->addField('limit',$limit);		$this->rpc_service->addField('offset',$offset);						$this->rpc_service->setWhere($search,$filterRules,$field_report);				if($print == 1){			//$this->rpc_service->addField('imode',$imode);		    //$result = $this->rpc_service->Print_absensi_report('','','','',$format,$date_start,$date_end,$departemen,$divisi,$sub_divisi,$lama_kerja,$jml_hari); 			$result = $this->rpc_service->resultJSON_pop();				// var_dump($result);			$data_result = json_decode($result['data'],true);			$result = $this->rpc_service->Print_absensi_report_2($data_result,$format,$result['valid'],$result['no'],$result['des']);					   // var_dump($data_result);            echo json_encode($result);		} else {			$this->authentication->plainlayout();			$result = $this->rpc_service->resultJSON_pop();				$data_result = json_decode($result['data'],true);		    //var_dump($data_result['detail']);			if(isset($data_result['detail']['result_count'])){				$records = $data_result['detail']['result_count'];				$total = ceil($data_result['detail']['result_count'] / $limit);			} else {				$records = 0;				$total = 0;			}						$responce = new stdclass();			$responce->page = $page;			$responce->records = $records;			$responce->total = $total;			$i=0; 			if($data_result){				if(isset($data_result['xrow'])){					foreach($data_result['xrow'] as $key=>$value){						foreach ($value as $k => $v) {							$responce->rows[$i][$k] = $v;						} 						$i++;					}				}			}					echo json_encode($responce);		}	     //$loaddata = $this->ecc_library-> get_field_data_pop($view,$field);			//var_dump($loaddata);		//echo $loaddata;	}		 function loaddata_dashboard_S()   {	   	$field_report = $this->table_report();	    $this->load->model('main');					   // $karyawan_name = isset($_REQUEST['karyawan_name']) ?  $_REQUEST['karyawan_name'] : 0;	    $keterangan = isset($_REQUEST['ket']) ?  $_REQUEST['ket'] : 'S';		$lama_kerja= isset($_REQUEST['karyawan_lama_kerja']) ?  $_REQUEST['karyawan_lama_kerja'] : 0;		$date_start = isset($_REQUEST['date_start']) ? $_REQUEST['date_start'] : '';		$date_end = isset($_REQUEST['date_end']) ? $_REQUEST['date_end'] : '';		$print = isset($_REQUEST['print']) ? $_REQUEST['print'] : 0;		$format = isset($_REQUEST['format']) ? $_REQUEST['format'] : 'xlsx';		$page = isset($_POST['page'])?$_POST['page']:1; // get the requested page         $rows = isset($_POST['rows'])?$_POST['rows']:10; // get how many rows we want to have into the grid         $sidx = isset($_POST['sidx'])?$_POST['sidx']:'r2'; // get index row - i.e. user click to sort         $sord = isset($_POST['sord'])?$_POST['sord']:'0'; // get the direction 		$search = isset($_REQUEST['_search'])?$_REQUEST['_search']:false; 		$filterRules =  isset($_POST['filters'])?$_POST['filters']:false;		//$imode='2';		//$date_end='2024-01-27';				$jml_hari=$this->main->selisihHari($date_start, $date_end); // Cek hari libur dan jumlah hari		$jml_hari=$jml_hari+1;		//var_dump($keterangan);				$limit =  $rows;		$offset =  $rows * ($page - 1);		$order = isset($_REQUEST['order']) ? $_REQUEST['order'] : array();				if($sord == 'asc'){			$sord = 1;		} else {			$sord = 2;		}				$sort =	$sidx. '='.$sord;							if(strlen(trim($date_start)) == 0 ){			$date_start = '1900-01-01';		}				if(strlen(trim($date_end)) == 0 ){			$date_end = '9999-12-31';		}							$return = array();		$return['valid'] = false;		$return['message'] = "Internal Server Error"; 		$sp = "dbo.sp_rpt_absensi_dashboard";				if($print == 1){			$this->rpc_service->setSP(array("sp"=> $sp,"mode"=> $print == 1 ? "2" : "1","debug"=>"1"));		} else {			$this->rpc_service->setSP($sp);		}				//$this->rpc_service->addField('karyawan_name',$karyawan_name);		$this->rpc_service->addField('keterangan',$keterangan);		$this->rpc_service->addField('lama_kerja',$lama_kerja);		$this->rpc_service->addField('date_start',$date_start);		$this->rpc_service->addField('date_end',$date_end);		$this->rpc_service->addField('jml_hari',$jml_hari);		$this->rpc_service->addField('format',$format);		$this->rpc_service->addField('temp_folder',sys_get_temp_dir());		$this->rpc_service->addField('sort',$sort);		$this->rpc_service->addField('limit',$limit);		$this->rpc_service->addField('offset',$offset);						$this->rpc_service->setWhere($search,$filterRules,$field_report);				if($print == 1){			//$this->rpc_service->addField('imode',$imode);		    //$result = $this->rpc_service->Print_absensi_report('','','','',$format,$date_start,$date_end,$departemen,$divisi,$sub_divisi,$lama_kerja,$jml_hari); 			$result = $this->rpc_service->resultJSON_pop();				// var_dump($result);			$data_result = json_decode($result['data'],true);			$result = $this->rpc_service->Print_absensi_report_2($data_result,$format,$result['valid'],$result['no'],$result['des']);					   // var_dump($data_result);            echo json_encode($result);		} else {			$this->authentication->plainlayout();			$result = $this->rpc_service->resultJSON_pop();				$data_result = json_decode($result['data'],true);		    //var_dump($data_result['detail']);			if(isset($data_result['detail']['result_count'])){				$records = $data_result['detail']['result_count'];				$total = ceil($data_result['detail']['result_count'] / $limit);			} else {				$records = 0;				$total = 0;			}						$responce = new stdclass();			$responce->page = $page;			$responce->records = $records;			$responce->total = $total;			$i=0; 			if($data_result){				if(isset($data_result['xrow'])){					foreach($data_result['xrow'] as $key=>$value){						foreach ($value as $k => $v) {							$responce->rows[$i][$k] = $v;						} 						$i++;					}				}			}					echo json_encode($responce);		}	     //$loaddata = $this->ecc_library-> get_field_data_pop($view,$field);			//var_dump($loaddata);		//echo $loaddata;	}	    function loaddata_dashboard_C()      {	   	$field_report = $this->table_report();	    $this->load->model('main');					   // $karyawan_name = isset($_REQUEST['karyawan_name']) ?  $_REQUEST['karyawan_name'] : 0;	    $keterangan = isset($_REQUEST['ket']) ?  $_REQUEST['ket'] : 'CT';		$lama_kerja= isset($_REQUEST['karyawan_lama_kerja']) ?  $_REQUEST['karyawan_lama_kerja'] : 0;		$date_start = isset($_REQUEST['date_start']) ? $_REQUEST['date_start'] : '';		$date_end = isset($_REQUEST['date_end']) ? $_REQUEST['date_end'] : '';		$print = isset($_REQUEST['print']) ? $_REQUEST['print'] : 0;		$format = isset($_REQUEST['format']) ? $_REQUEST['format'] : 'xlsx';		$page = isset($_POST['page'])?$_POST['page']:1; // get the requested page         $rows = isset($_POST['rows'])?$_POST['rows']:10; // get how many rows we want to have into the grid         $sidx = isset($_POST['sidx'])?$_POST['sidx']:'r2'; // get index row - i.e. user click to sort         $sord = isset($_POST['sord'])?$_POST['sord']:'0'; // get the direction 		$search = isset($_REQUEST['_search'])?$_REQUEST['_search']:false; 		$filterRules =  isset($_POST['filters'])?$_POST['filters']:false;		//$imode='2';		//$date_end='2024-01-27';				$jml_hari=$this->main->selisihHari($date_start, $date_end); // Cek hari libur dan jumlah hari		$jml_hari=$jml_hari+1;		//var_dump($keterangan);				$limit =  $rows;		$offset =  $rows * ($page - 1);		$order = isset($_REQUEST['order']) ? $_REQUEST['order'] : array();				if($sord == 'asc'){			$sord = 1;		} else {			$sord = 2;		}				$sort =	$sidx. '='.$sord;							if(strlen(trim($date_start)) == 0 ){			$date_start = '1900-01-01';		}				if(strlen(trim($date_end)) == 0 ){			$date_end = '9999-12-31';		}							$return = array();		$return['valid'] = false;		$return['message'] = "Internal Server Error"; 		$sp = "dbo.sp_rpt_absensi_dashboard";				if($print == 1){			$this->rpc_service->setSP(array("sp"=> $sp,"mode"=> $print == 1 ? "2" : "1","debug"=>"1"));		} else {			$this->rpc_service->setSP($sp);		}				//$this->rpc_service->addField('karyawan_name',$karyawan_name);		$this->rpc_service->addField('keterangan',$keterangan);		$this->rpc_service->addField('lama_kerja',$lama_kerja);		$this->rpc_service->addField('date_start',$date_start);		$this->rpc_service->addField('date_end',$date_end);		$this->rpc_service->addField('jml_hari',$jml_hari);		$this->rpc_service->addField('format',$format);		$this->rpc_service->addField('temp_folder',sys_get_temp_dir());		$this->rpc_service->addField('sort',$sort);		$this->rpc_service->addField('limit',$limit);		$this->rpc_service->addField('offset',$offset);						$this->rpc_service->setWhere($search,$filterRules,$field_report);				if($print == 1){			//$this->rpc_service->addField('imode',$imode);		    //$result = $this->rpc_service->Print_absensi_report('','','','',$format,$date_start,$date_end,$departemen,$divisi,$sub_divisi,$lama_kerja,$jml_hari); 			$result = $this->rpc_service->resultJSON_pop();				// var_dump($result);			$data_result = json_decode($result['data'],true);			$result = $this->rpc_service->Print_absensi_report_2($data_result,$format,$result['valid'],$result['no'],$result['des']);					   // var_dump($data_result);            echo json_encode($result);		} else {			$this->authentication->plainlayout();			$result = $this->rpc_service->resultJSON_pop();				$data_result = json_decode($result['data'],true);		    //var_dump($data_result['detail']);			if(isset($data_result['detail']['result_count'])){				$records = $data_result['detail']['result_count'];				$total = ceil($data_result['detail']['result_count'] / $limit);			} else {				$records = 0;				$total = 0;			}						$responce = new stdclass();			$responce->page = $page;			$responce->records = $records;			$responce->total = $total;			$i=0; 			if($data_result){				if(isset($data_result['xrow'])){					foreach($data_result['xrow'] as $key=>$value){						foreach ($value as $k => $v) {							$responce->rows[$i][$k] = $v;						} 						$i++;					}				}			}					echo json_encode($responce);		}	     //$loaddata = $this->ecc_library-> get_field_data_pop($view,$field);			//var_dump($loaddata);		//echo $loaddata;	}     function loaddata_dashboard_P3()      {	   	$field_report = $this->table_report();	    $this->load->model('main');					   // $karyawan_name = isset($_REQUEST['karyawan_name']) ?  $_REQUEST['karyawan_name'] : 0;	    $keterangan = isset($_REQUEST['ket']) ?  $_REQUEST['ket'] : 'P3';		$lama_kerja= isset($_REQUEST['karyawan_lama_kerja']) ?  $_REQUEST['karyawan_lama_kerja'] : 0;		$date_start = isset($_REQUEST['date_start']) ? $_REQUEST['date_start'] : '';		$date_end = isset($_REQUEST['date_end']) ? $_REQUEST['date_end'] : '';		$print = isset($_REQUEST['print']) ? $_REQUEST['print'] : 0;		$format = isset($_REQUEST['format']) ? $_REQUEST['format'] : 'xlsx';		$page = isset($_POST['page'])?$_POST['page']:1; // get the requested page         $rows = isset($_POST['rows'])?$_POST['rows']:10; // get how many rows we want to have into the grid         $sidx = isset($_POST['sidx'])?$_POST['sidx']:'r2'; // get index row - i.e. user click to sort         $sord = isset($_POST['sord'])?$_POST['sord']:'0'; // get the direction 		$search = isset($_REQUEST['_search'])?$_REQUEST['_search']:false; 		$filterRules =  isset($_POST['filters'])?$_POST['filters']:false;		//$imode='2';		//$date_end='2024-01-27';				$jml_hari=$this->main->selisihHari($date_start, $date_end); // Cek hari libur dan jumlah hari		$jml_hari=$jml_hari+1;		//var_dump($keterangan);				$limit =  $rows;		$offset =  $rows * ($page - 1);		$order = isset($_REQUEST['order']) ? $_REQUEST['order'] : array();				if($sord == 'asc'){			$sord = 1;		} else {			$sord = 2;		}				$sort =	$sidx. '='.$sord;							if(strlen(trim($date_start)) == 0 ){			$date_start = '1900-01-01';		}				if(strlen(trim($date_end)) == 0 ){			$date_end = '9999-12-31';		}							$return = array();		$return['valid'] = false;		$return['message'] = "Internal Server Error"; 		$sp = "dbo.sp_rpt_absensi_dashboard";				if($print == 1){			$this->rpc_service->setSP(array("sp"=> $sp,"mode"=> $print == 1 ? "2" : "1","debug"=>"1"));		} else {			$this->rpc_service->setSP($sp);		}				//$this->rpc_service->addField('karyawan_name',$karyawan_name);		$this->rpc_service->addField('keterangan',$keterangan);		$this->rpc_service->addField('lama_kerja',$lama_kerja);		$this->rpc_service->addField('date_start',$date_start);		$this->rpc_service->addField('date_end',$date_end);		$this->rpc_service->addField('jml_hari',$jml_hari);		$this->rpc_service->addField('format',$format);		$this->rpc_service->addField('temp_folder',sys_get_temp_dir());		$this->rpc_service->addField('sort',$sort);		$this->rpc_service->addField('limit',$limit);		$this->rpc_service->addField('offset',$offset);						$this->rpc_service->setWhere($search,$filterRules,$field_report);				if($print == 1){			//$this->rpc_service->addField('imode',$imode);		    //$result = $this->rpc_service->Print_absensi_report('','','','',$format,$date_start,$date_end,$departemen,$divisi,$sub_divisi,$lama_kerja,$jml_hari); 			$result = $this->rpc_service->resultJSON_pop();				// var_dump($result);			$data_result = json_decode($result['data'],true);			$result = $this->rpc_service->Print_absensi_report_2($data_result,$format,$result['valid'],$result['no'],$result['des']);					   // var_dump($data_result);            echo json_encode($result);		} else {			$this->authentication->plainlayout();			$result = $this->rpc_service->resultJSON_pop();				$data_result = json_decode($result['data'],true);		    //var_dump($data_result['detail']);			if(isset($data_result['detail']['result_count'])){				$records = $data_result['detail']['result_count'];				$total = ceil($data_result['detail']['result_count'] / $limit);			} else {				$records = 0;				$total = 0;			}						$responce = new stdclass();			$responce->page = $page;			$responce->records = $records;			$responce->total = $total;			$i=0; 			if($data_result){				if(isset($data_result['xrow'])){					foreach($data_result['xrow'] as $key=>$value){						foreach ($value as $k => $v) {							$responce->rows[$i][$k] = $v;						} 						$i++;					}				}			}					echo json_encode($responce);		}	     //$loaddata = $this->ecc_library-> get_field_data_pop($view,$field);			//var_dump($loaddata);		//echo $loaddata;	}   function find_dashboard() {	    $this->load->model('main');		 $this->authentication->plainlayout();	    $date_start = isset($_POST['date_start']) ? $_POST['date_start'] : '';		$date_end = isset($_POST['date_end']) ? $_POST['date_end'] : '';				$cek= $this->main->cek_keterangan($date_start,$date_end );		$jml_hari=$this->main->selisihHari($date_start, $date_end); // Cek hari libur dan jumlah hari		$component['jml_hari']=$jml_hari+1;						$component['jumlah_M'] = $cek[0]['jml_M'];		$component['jumlah_S'] = $cek[0]['jml_S'];		$component['jumlah_cuti'] = $cek[0]['jml_cuti'];		$component['jumlah_cuti_lahir'] = $cek[0]['jml_cuti_lahir'];		$component['jumlah_P2'] = $cek[0]['jml_P2'];		$component['jumlah_P3'] = $cek[0]['jml_P3'];		$component['jumlah_IP'] = $cek[0]['jml_IP'];		$component['jumlah_SD'] = $cek[0]['jml_SD'];		$component['jumlah_T'] = $cek[0]['jml_T'];		$component['jumlah_DL'] = $cek[0]['jml_DL'];		$component['jumlah_TM'] = $cek[0]['jml_TM'];		$component['jumlah_TP'] = $cek[0]['jml_TP'];		$component['jumlah_PC'] = $cek[0]['jml_PC'];				//$this->authentication->ajaxlayout($component);				echo json_encode($component);		//$this->authentication->ajaxlayout($component);   }				function post_add_edit() {		$this->authentication->plainlayout();		$parameter = array();		$return = array();		    $karyawan_id = isset($_POST['karyawan_id']) ? $_POST['karyawan_id'] : '';		$nama_karyawan = isset($_POST['nama_karyawan']) ? $_POST['nama_karyawan'] : '';		$gender = isset($_POST['gender_id']) ? $_POST['gender_id'] : '';		$nik = isset($_POST['nik']) ? $_POST['nik'] : '';		$badgenumber = isset($_POST['badgenumber']) ? $_POST['badgenumber'] : '';		$divisi = isset($_POST['divisi_id']) ? $_POST['divisi_id'] : '';		$departement = isset($_POST['departement_id']) ? $_POST['departement_id'] : '';		$status = isset($_POST['status_id']) ? $_POST['status_id'] : '';		$email = isset($_POST['email']) ? $_POST['email'] : '';		$jabatan = isset($_POST['jabatan_id']) ? $_POST['jabatan_id'] : '';		$date_in = isset($_POST['date_in']) ? $_POST['date_in'] : '';		$date_out = isset($_POST['date_out']) ? $_POST['date_out'] : '';		$group = isset($_POST['group']) ? $_POST['group'] : '';		$photo = isset($_FILES['file']) ? $_FILES['file'] : '';						//$purchase_order_no = isset($_POST['purchase_order_no']) ? $_POST['purchase_order_no'] : '';		//$purchase_order_date = isset($_POST['purchase_order_date']) ? $_POST['purchase_order_date'] : '';		//$partner_id = isset($_POST['partner_id']) ? $_POST['partner_id'] : '';		//$currencies_id = isset($_POST['currencies_id']) ? $_POST['currencies_id'] : '';		//$purchase_type_id = isset($_POST['purchase_type_id']) ? $_POST['purchase_type_id'] : '';		//$this_memo = isset($_POST['this_memo']) ? $_POST['this_memo'] : '';		//$purchase_order_type_id = isset($_POST['purchase_order_type_id']) ? $_POST['purchase_order_type_id'] : '';		//$purchase_order_memo = isset($_POST['purchase_order_memo']) ? $_POST['purchase_order_memo'] : '';		$user_id = $this->session->userdata('user_id');				//------ Untuk proses Upload photo ------------		  if($_POST['info'] =='Yes'){			    $file=$_FILES['file'];			    $file_name = $file['name'];			    $file_temp=$file['tmp_name'];				$lok='./assets/img/profile/'.$nama_karyawan.'/';				$dir=false;				if(!is_dir($lok)){			       $dir=mkdir("./assets/img/profile/".$nama_karyawan."/dokumen",0777,true);				}				$namaFile=$nama_karyawan.'_'.date('His').'_'.$file_name;				                if ($dir) {                    $location='./assets/img/profile/'.$nama_karyawan.'/'.$namaFile;                } else {					$location='./assets/img/profile/'.$namaFile;                                 }									    $upload=move_uploaded_file($file_temp,$location);			 				if ($upload){					$upload_photo=true;				}else{					$upload_photo=false;				}	 	 // var_dump($location.' - '.$upload);die();			 }else{			 $namaFile='';			 $location='';		 }		 		//---------------------------------------------				$link_photo=$location;	 //   var_dump($link_photo);die();		$result = array();		$return['valid'] = false;		$return['status_code'] = 501;		$return['message'] = "Internal Server Error";				if(count($_POST) > 0){			//--cek apakah proses edit atau add -------------			if($karyawan_id){				$this->rpc_service->setSP("dbo.sp_karyawan_edit");				$this->rpc_service->addField('karyawan_id',$karyawan_id);			} else {				$this->rpc_service->setSP("dbo.sp_karyawan_add");			}							$this->rpc_service->addField('nama_karyawan',$nama_karyawan);			$this->rpc_service->addField('gender',$gender);			$this->rpc_service->addField('nik',$nik);			$this->rpc_service->addField('badgenumber',$badgenumber);			$this->rpc_service->addField('divisi',$divisi);			$this->rpc_service->addField('departement',$departement);			$this->rpc_service->addField('status',$status);			$this->rpc_service->addField('email',$email);			$this->rpc_service->addField('jabatan',$jabatan);			$this->rpc_service->addField('date_in',$date_in);			$this->rpc_service->addField('date_out',$date_out);			$this->rpc_service->addField('group',$group);			$this->rpc_service->addField('link_photo',$link_photo);						$result = $this->rpc_service->resultJSON_pop();						$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$data_result = json_decode($result['data'],true);														$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];							$return['karyawan_id'] = $data_result['karyawan_id'];						}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}						} else {			$return['valid'] = false;			$return['message'] = "Session expired";		}		//var_dump($link_photo);		//var_dump($return['karyawan_id']);		echo json_encode($return);	}			function post_add_edit_absen(){	    $this->authentication->plainlayout();		$return = array();			  	$absen_id = isset($_POST['absen_id']) ? $_POST['absen_id'] : '';		$tanggal_absen = isset($_POST['tanggal_absen']) ? $_POST['tanggal_absen'] : '';		$badgenumber = isset($_POST['badgenumber']) ? $_POST['badgenumber'] : '';		$in = isset($_POST['in']) ? $_POST['in'] : '';		$out = isset($_POST['out']) ? $_POST['out'] : '';		$keterangan_absen = isset($_POST['keterangan_absen']) ? $_POST['keterangan_absen'] : 0;				$user_id = $this->session->userdata('user_id');				if(count($_POST) > 0){			if($absen_id){				// var_dump($absen_id);				$this->rpc_service->setSP("dbo.sp_karyawan_absen_edit");				$this->rpc_service->addField('absen_id',$absen_id);			} else {				$this->rpc_service->setSP("dbo.sp_karyawan_absen_add");				$this->rpc_service->addField('absen_id','');				//$this->load->model('main');		   	}						//$this->rpc_service->addField('karyawan_id',$karyawan_id);		    $this->rpc_service->addField('tanggal_absen',$tanggal_absen);			$this->rpc_service->addField('badgenumber',$badgenumber);			$this->rpc_service->addField('in',$in);			$this->rpc_service->addField('out',$out);			$this->rpc_service->addField('keterangan_absen',$keterangan_absen);						$result = $this->rpc_service->resultJSON_pop();			//var_dump($result['data']);die();			$data = array();			if(isset($result)){				if(isset($result['valid'])){					if($result['valid']){						if(isset($result['data'])){							$data_result = json_decode($result['data'],TRUE);														$return['valid'] = $result['valid'];							$return['status_code'] = $result['no'];							$return['message'] = $result['des'];							$return['absen_id'] = $data_result['absen_id'];							$return['badgenumber'] = $data_result['badgenumber'];							//$return['tanggal_absen'] = $data_result['tanggal_absen'];							//$return['keterangan_absen'] = $data_result['keterangan_absen'];													}					} else {						$return['status_code'] = $result['no'];						$return['message'] = $result['des'];					}				}			}							}else {			$return['valid'] = false;			$return['message'] = "Session expired";		}						echo json_encode($return);   }		}?>